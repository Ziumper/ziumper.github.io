<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.4">Jekyll</generator><link href="https://ziumper.github.io/pl/feed.xml" rel="self" type="application/atom+xml"/><link href="https://ziumper.github.io/pl/" rel="alternate" type="text/html" hreflang="en"/><updated>2025-09-18T15:44:53+00:00</updated><id>https://ziumper.github.io/feed.xml</id><title type="html">Ziumper</title><entry><title type="html">ğŸ§ PHP, Liczby zmiennoprzecinkowe i Tajemnica -0.0 PrzeglÄ…d PHP #5</title><link href="https://ziumper.github.io/pl/blog/2025/Floats-and-mystery-of-zero/" rel="alternate" type="text/html" title="ğŸ§ PHP, Liczby zmiennoprzecinkowe i Tajemnica -0.0 PrzeglÄ…d PHP #5"/><published>2025-09-18T00:00:00+00:00</published><updated>2025-09-18T00:00:00+00:00</updated><id>https://ziumper.github.io/blog/2025/Floats-and-mystery-of-zero</id><content type="html" xml:base="https://ziumper.github.io/blog/2025/Floats-and-mystery-of-zero/"><![CDATA[<p>Tak, serio. <code class="language-plaintext highlighter-rouge">-0.0</code> i <code class="language-plaintext highlighter-rouge">0.0</code> to dwie rÃ³Å¼ne reprezentacje bajtowe w standardzie <a href="https://pl.wikipedia.org/wiki/IEEE_754">IEEE 754</a> â€“ ale w praktyceâ€¦ PHP i tak je traktuje tak samo.</p> <p>MiaÅ‚em taki kod:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">getPercentage</span><span class="p">():</span> <span class="kt">int</span>
<span class="p">{</span>
    <span class="c1">// epsilon to avoid division by zero</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">limitPrice</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="nb">round</span><span class="p">((</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">totalCartPrice</span> <span class="o">/</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">limitPrice</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div> <p>I zaczÄ…Å‚em siÄ™ zastanawiaÄ‡:</p> <ul> <li>Czy mogÄ™ po prostu porÃ³wnaÄ‡ <code class="language-plaintext highlighter-rouge">$this-&gt;limitPrice == 0.0</code>?</li> <li>A co jeÅ›li <code class="language-plaintext highlighter-rouge">limitPrice</code> = <code class="language-plaintext highlighter-rouge">-0.0</code>? ğŸ¤¯</li> </ul> <hr/> <h2 id="-analiza">ğŸ”¬ Analiza</h2> <h3 id="1ï¸âƒ£-ieee-754-i--00">1ï¸âƒ£ IEEE 754 i -0.0</h3> <p>W standardzie liczb zmiennoprzecinkowych istnieje <strong>dodatnie zero (0.0)</strong> i <strong>ujemne zero (-0.0)</strong>.<br/> Na poziomie bajtÃ³w to dwie rÃ³Å¼ne wartoÅ›ci:</p> <ul> <li><code class="language-plaintext highlighter-rouge">0.0</code> â†’ <code class="language-plaintext highlighter-rouge">0x0000000000000000</code></li> <li><code class="language-plaintext highlighter-rouge">-0.0</code> â†’ <code class="language-plaintext highlighter-rouge">0x8000000000000000</code></li> </ul> <p>Czyli tak, binarnie to nie to samo.</p> <hr/> <h3 id="2ï¸âƒ£-co-na-to-php">2ï¸âƒ£ Co na to PHP?</h3> <p>PorÃ³wnajmy:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">var_dump</span><span class="p">(</span><span class="mf">0.0</span> <span class="o">==</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">);</span>   <span class="c1">// true</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="mf">0.0</span> <span class="o">===</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">);</span>  <span class="c1">// true</span>
</code></pre></div></div> <p>âœ… PHP traktuje te dwie wartoÅ›ci jako rÃ³wne zarÃ³wno w porÃ³wnaniu luÅºnym (<code class="language-plaintext highlighter-rouge">==</code>), jak i Å›cisÅ‚ym (<code class="language-plaintext highlighter-rouge">===</code>).</p> <p>Ale uwaga:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">var_dump</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">0.0</span><span class="p">);</span>  <span class="c1">// float(INF)</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">);</span> <span class="c1">// float(-INF)</span>
</code></pre></div></div> <p>â¡ï¸ Przy dzieleniu widaÄ‡ rÃ³Å¼nicÄ™ â€“ znak zera wpÅ‚ywa na wynik (<code class="language-plaintext highlighter-rouge">+âˆ</code> vs <code class="language-plaintext highlighter-rouge">-âˆ</code>).</p> <hr/> <h3 id="3ï¸âƒ£-czy-to-ma-znaczenie-w-moim-przypadku">3ï¸âƒ£ Czy to ma znaczenie w moim przypadku?</h3> <p>W moim kodzie <code class="language-plaintext highlighter-rouge">limitPrice</code> ma <strong>maksymalnie 4 miejsca po przecinku</strong>, pochodzi z bazy danych lub prostych operacji.<br/> Nie mam tu ujemnych zer z kosmosu.<br/> W praktyce mogÄ™ spokojnie napisaÄ‡:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">limitPrice</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>I wszystko dziaÅ‚a jak naleÅ¼y.<br/> Epsilon (<code class="language-plaintext highlighter-rouge">1e-8</code>) nie jest potrzebny, bo nie mam problemÃ³w z bÅ‚Ä™dami zaokrÄ…gleÅ„ na poziomie 17 miejsc po przecinku.</p> <hr/> <h2 id="-bonus-jak-wykryÄ‡--00-dla-nerdÃ³w">ğŸ›  Bonus: Jak wykryÄ‡ -0.0 (dla nerdÃ³w)</h2> <p>JeÅ¼eli jednak z jakiegoÅ› powodu <strong>musisz wiedzieÄ‡, czy to -0.0</strong>, oto trik:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">isNegativeZero</span><span class="p">(</span><span class="kt">float</span> <span class="nv">$x</span><span class="p">):</span> <span class="kt">bool</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$x</span> <span class="o">===</span> <span class="mf">0.0</span> <span class="o">&amp;&amp;</span> <span class="mi">1</span> <span class="o">/</span> <span class="nv">$x</span> <span class="o">===</span> <span class="o">-</span><span class="no">INF</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">var_dump</span><span class="p">(</span><span class="nf">isNegativeZero</span><span class="p">(</span><span class="mf">0.0</span><span class="p">));</span>  <span class="c1">// false</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nf">isNegativeZero</span><span class="p">(</span><span class="o">-</span><span class="mf">0.0</span><span class="p">));</span> <span class="c1">// true</span>
</code></pre></div></div> <p>Tak, trzeba podzieliÄ‡ przez zero, Å¼eby to wykryÄ‡. ğŸ§ª</p> <hr/> <h2 id="-wniosek">âœ… Wniosek</h2> <ul> <li>Tak, -0.0 i 0.0 to rÃ³Å¼ne bajty.</li> <li>PHP traktuje je jako rÃ³wne (<code class="language-plaintext highlighter-rouge">==</code>, <code class="language-plaintext highlighter-rouge">===</code>).</li> <li>MoÅ¼esz Å›miaÅ‚o pisaÄ‡ <code class="language-plaintext highlighter-rouge">== 0.0</code> w porÃ³wnaniach.</li> <li>Jedynie dzielenie przez 0.0 i -0.0 zwraca rÃ³Å¼ne nieskoÅ„czonoÅ›ci (INF vs -INF) â€“ wiÄ™c jak dzielisz, warto uÅ¼ywaÄ‡ <code class="language-plaintext highlighter-rouge">abs()</code>.</li> </ul> <hr/> <h2 id="-podsumowanie">ğŸ‰ Podsumowanie</h2> <p>UdaÅ‚o mi siÄ™ uproÅ›ciÄ‡ kod i <strong>zamiast epsilonÃ³w</strong> mam po prostu:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">getPercentage</span><span class="p">():</span> <span class="kt">int</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">limitPrice</span> <span class="o">?</span>
        <span class="o">:</span> <span class="nb">min</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="nb">round</span><span class="p">((</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">totalCartPrice</span> <span class="o">/</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">limitPrice</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>Czytelniej, proÅ›ciej i dalej bezpiecznie.<br/> A fakt, Å¼e -0.0 istnieje, zostawiam jako ciekawostkÄ™ do impressowania znajomych programistÃ³w na kawie. â˜•ï¸ğŸ˜</p> <p>PS: JeÅ¼eli zaleÅ¼y Ci na uÅ¼yciu epislona to chyba znacznie lepiej uÅ¼yÄ‡ tej staÅ‚ej.</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kc">PHP_FLOAT_EPSILON</span>
</code></pre></div></div>]]></content><author><name></name></author><category term="php"/><summary type="html"><![CDATA[Czy wiesz, Å¼e w PHP istnieje ujemne zero? Ten post to podrÃ³Å¼ przez Å›wiat ujemnych zer, dzielenia przez nieskoÅ„czonoÅ›Ä‡ i tego, czemu w Twoim kodzie i tak moÅ¼esz spokojnie pisaÄ‡ == 0.0.]]></summary></entry><entry><title type="html">PhpUnit willReturnMap - PrzeglÄ…d PHP #4</title><link href="https://ziumper.github.io/pl/blog/2025/PHPUnit-will-return-map-trap/" rel="alternate" type="text/html" title="PhpUnit willReturnMap - PrzeglÄ…d PHP #4"/><published>2025-09-17T00:00:00+00:00</published><updated>2025-09-17T00:00:00+00:00</updated><id>https://ziumper.github.io/blog/2025/PHPUnit-will-return-map-trap</id><content type="html" xml:base="https://ziumper.github.io/blog/2025/PHPUnit-will-return-map-trap/"><![CDATA[<p>Historia o tym, jak przez jeden maÅ‚y <code class="language-plaintext highlighter-rouge">null</code> straciÅ‚em 30 minut Å¼ycia na debugowanie testÃ³w,<br/> a potem znalazÅ‚em prawdÄ™ w dokumentacjiâ€¦ ktÃ³ra milczy na ten temat. ğŸ™ƒ</p> <hr/> <h2 id="-problem">ğŸ§ Problem</h2> <p>ZaÅ‚Ã³Å¼my, Å¼e mamy takÄ… metodÄ™:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">MyService</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">doStuff</span><span class="p">(</span><span class="kt">string</span> <span class="nv">$key</span><span class="p">,</span> <span class="kt">?string</span> <span class="nv">$flag</span> <span class="o">=</span> <span class="kc">null</span><span class="p">):</span> <span class="kt">string</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">"Result: "</span> <span class="mf">.</span> <span class="nv">$key</span> <span class="mf">.</span> <span class="p">(</span><span class="nv">$flag</span> <span class="o">?</span> <span class="s2">" (</span><span class="nv">$flag</span><span class="s2">)"</span> <span class="o">:</span> <span class="s2">""</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>I chcemy przetestowaÄ‡ klasÄ™, ktÃ³ra uÅ¼ywa <code class="language-plaintext highlighter-rouge">MyService</code> â€“ oczywiÅ›cie z mockiem.<br/> UÅ¼ywamy <strong><code class="language-plaintext highlighter-rouge">willReturnMap</code></strong>, bo jest eleganckie i dziaÅ‚a dla wielu zestawÃ³w argumentÃ³w.</p> <p>Brzmi prosto?<br/> No to spÃ³jrzmy na test:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$mock</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">createMock</span><span class="p">(</span><span class="nc">MyService</span><span class="o">::</span><span class="n">class</span><span class="p">);</span>

<span class="nv">$mock</span><span class="o">-&gt;</span><span class="nf">method</span><span class="p">(</span><span class="s1">'doStuff'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">willReturnMap</span><span class="p">([</span>
        <span class="p">[</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">,</span> <span class="s1">'Result: foo (bar)'</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">'baz'</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s1">'Result: baz'</span><span class="p">],</span>
    <span class="p">]);</span>
</code></pre></div></div> <p>Brzmi dobrze, nie?<br/> <strong>NIE.</strong> ğŸ˜…</p> <hr/> <h2 id="-co-siÄ™-dzieje">ğŸ’¥ Co siÄ™ dzieje?</h2> <p>JeÅ›li nie przekaÅ¼esz dokÅ‚adnie tylu argumentÃ³w, ile metoda przyjmuje, PHPUnit powie:</p> <blockquote> <p>â€œNie wiem o co ci chodziâ€ ğŸ¤·â€â™‚ï¸<br/> i zwrÃ³ci <code class="language-plaintext highlighter-rouge">null</code>.</p> </blockquote> <p>Czyli gdy w kodzie produkcyjnym wywoÅ‚asz:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$service</span><span class="o">-&gt;</span><span class="nf">doStuff</span><span class="p">(</span><span class="s1">'baz'</span><span class="p">);</span>
</code></pre></div></div> <p>to mock powie:</p> <blockquote> <p>â€œPrzykro mi, ale ja nie znam takiej mapyâ€.</p> </blockquote> <p>I test wybucha. ğŸ’£</p> <hr/> <h2 id="-dlaczego-tak-jest">ğŸ¤¯ Dlaczego tak jest?</h2> <p>Bo <code class="language-plaintext highlighter-rouge">willReturnMap</code> dopasowuje argumenty <strong>po kolei</strong>, 1:1.<br/> DomyÅ›lny argument <code class="language-plaintext highlighter-rouge">null</code> nie jest w magiczny sposÃ³b â€œzgadywanyâ€.<br/> Trzeba go tam podaÄ‡ jawnie w tablicy.</p> <hr/> <h2 id="-poprawne-rozwiÄ…zanie">âœ… Poprawne rozwiÄ…zanie</h2> <p>Trzeba <strong>dopasowaÄ‡ dokÅ‚adnie liczbÄ™ argumentÃ³w</strong>, nawet jeÅ›li sÄ… domyÅ›lne:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$mock</span><span class="o">-&gt;</span><span class="nf">method</span><span class="p">(</span><span class="s1">'doStuff'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">willReturnMap</span><span class="p">([</span>
        <span class="p">[</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">,</span> <span class="s1">'Result: foo (bar)'</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">'baz'</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s1">'Result: baz'</span><span class="p">],</span> <span class="c1">// &lt;--- null musi byÄ‡!</span>
    <span class="p">]);</span>
</code></pre></div></div> <p>Tak, wiem â€“ niby oczywiste, ale jednak czÅ‚owiek czasem liczy na trochÄ™ magii. ğŸª„<br/> Niestety â€“ PHPUnit tutaj magii nie oferuje.</p> <hr/> <h2 id="-moraÅ‚-historii">ğŸ“ MoraÅ‚ historii</h2> <ul> <li><code class="language-plaintext highlighter-rouge">willReturnMap</code> jest super, ale jest <strong>bardzo dosÅ‚owne</strong>.</li> <li>JeÅ›li metoda ma 2 argumenty â€“ w mapie teÅ¼ musisz mieÄ‡ 2 argumenty.</li> <li>Nawet jeÅ›li ten drugi argument ma <code class="language-plaintext highlighter-rouge">null</code> jako default.</li> <li>PHPUnit nie robi za wrÃ³Å¼kÄ™ â€“ nie zgadnie, Å¼e miaÅ‚eÅ› na myÅ›li default. ğŸ˜…</li> </ul> <hr/> <h2 id="-wnioski">ğŸ‰ Wnioski</h2> <p>Po tym odkryciu moje testy przestaÅ‚y eksplodowaÄ‡.<br/> Wiedza, Å¼e <strong>trzeba jawnie podaÄ‡ kaÅ¼dy argument w mapie</strong>, oszczÄ™dziÅ‚a mi godzin debugowania.<br/> Teraz juÅ¼ wiem â€“ przy mockach <strong>lepiej podaÄ‡ o jeden argument za duÅ¼o niÅ¼ za maÅ‚o</strong>.</p> <blockquote> <p>ğŸ§  <strong>Meritum:</strong> <code class="language-plaintext highlighter-rouge">willReturnMap</code> â‰  elastyczne dopasowanie.<br/> To <strong>twarda mapa argumentÃ³w</strong> â€“ podaj wszystko albo nie narzekaj, Å¼e testy pÅ‚onÄ…. ğŸ”¥</p> </blockquote> <hr/> <p>âœï¸ <strong>PS:</strong> JeÅ›li ktoÅ› znajdzie w dokumentacji PHPUnit wzmiankÄ™ o tym case â€“ dajcie znaÄ‡.<br/> Ja nie znalazÅ‚em, a przeszukaÅ‚em pÃ³Å‚ internetu. ğŸ™ˆ</p> <p><a href="https://docs.phpunit.de/en/12.3/test-doubles.html#willreturnmap">Link do dokumentacji</a></p>]]></content><author><name></name></author><category term="php"/><summary type="html"><![CDATA[ğŸ› "PhpUnit, willReturnMap i domyÅ›lne argumenty â€“ czyli jak wpaÅ›Ä‡ w subtelnÄ… puÅ‚apkÄ™ ğŸª¤"]]></summary></entry><entry><title type="html">BackedEnum - PrzeglÄ…d PHP #3</title><link href="https://ziumper.github.io/pl/blog/2025/PHP-Backed-enums/" rel="alternate" type="text/html" title="BackedEnum - PrzeglÄ…d PHP #3"/><published>2025-09-16T00:00:00+00:00</published><updated>2025-09-16T00:00:00+00:00</updated><id>https://ziumper.github.io/blog/2025/PHP-Backed-enums</id><content type="html" xml:base="https://ziumper.github.io/blog/2025/PHP-Backed-enums/"><![CDATA[<p>Historia pewnego developera, ktÃ³ry postanowiÅ‚ poÅ¼egnaÄ‡ siÄ™ z niekoÅ„czÄ…cymi siÄ™ <code class="language-plaintext highlighter-rouge">const</code> i tablicami mapperÃ³w.<br/> Przy okazji dowiesz siÄ™, czym sÄ… <code class="language-plaintext highlighter-rouge">BackedEnums</code>, jakie majÄ… plusy i minusy, i czemu czasem lepiej siÄ™gnÄ…Ä‡ po <code class="language-plaintext highlighter-rouge">enum-name</code> niÅ¼ powielaÄ‡ wartoÅ›ci stringÃ³w.</p> <h2 id="-co-to-w-ogÃ³le-sÄ…-te-backedenums">ğŸ¤” Co to w ogÃ³le sÄ… te BackedEnums?</h2> <p>Od PHP <strong>8.1</strong> dostaliÅ›my wreszcie coÅ›, na co czekaliÅ›my od lat â€“ <strong>enumy</strong>!<br/> A do tego mamy ich bardziej wypasionÄ… wersjÄ™ â€“ <strong>BackedEnums</strong>.<br/> SÄ… to takie enumy, ktÃ³re oprÃ³cz nazwy mogÄ… mieÄ‡ jeszcze wartoÅ›Ä‡ (<code class="language-plaintext highlighter-rouge">string</code> albo <code class="language-plaintext highlighter-rouge">int</code>).<br/> Brzmi jak <code class="language-plaintext highlighter-rouge">const</code> w klasie, ale jest o niebo lepsze. ğŸ’ª</p> <h3 id="przykÅ‚ad-w-akcji">PrzykÅ‚ad w akcji</h3> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">enum</span> <span class="nc">Status</span><span class="o">:</span> <span class="n">string</span> <span class="p">{</span>
     <span class="k">case</span> <span class="k">NEW</span> <span class="o">=</span> <span class="s1">'new'</span><span class="p">;</span>
     <span class="k">case</span> <span class="no">IN_PROGRESS</span> <span class="o">=</span> <span class="s1">'in_progress'</span><span class="p">;</span>
     <span class="k">case</span> <span class="no">DONE</span> <span class="o">=</span> <span class="s1">'done'</span><span class="p">;</span>
 <span class="p">}</span>

 <span class="c1">// UÅ¼ycie</span>
 <span class="nv">$orderStatus</span> <span class="o">=</span> <span class="nc">Status</span><span class="o">::</span><span class="k">NEW</span><span class="p">;</span>
 <span class="k">echo</span> <span class="nv">$orderStatus</span><span class="o">-</span><span class="n">value</span><span class="p">;</span> <span class="c1">// "new"</span>
 <span class="k">echo</span> <span class="nv">$orderStatus</span><span class="o">-</span><span class="n">name</span><span class="p">;</span>  <span class="c1">// "NEW"</span>
</code></pre></div></div> <hr/> <h2 id="-a-po-co-mi-to">ğŸ§ A po co mi to?</h2> <h3 id="zalety">Zalety:</h3> <ul> <li>âœ… <strong>CzytelnoÅ›Ä‡</strong> â€“ koniec z magicznymi stringami i zgadywaniem, co autor miaÅ‚ na myÅ›li.</li> <li>âœ… <strong>BezpieczeÅ„stwo typÃ³w</strong> â€“ nie wciÅ›niesz do funkcji <code class="language-plaintext highlighter-rouge">"N3W"</code> zamiast <code class="language-plaintext highlighter-rouge">"NEW"</code>.</li> <li>âœ… <strong>ÅatwoÅ›Ä‡ refaktoryzacji</strong> â€“ zmieniasz wartoÅ›Ä‡ w jednym miejscu i gotowe.</li> <li>âœ… <strong>Metody pomocnicze</strong> â€“ moÅ¼esz wrzucaÄ‡ do enumÃ³w logikÄ™ (np. <code class="language-plaintext highlighter-rouge">isFinished()</code>).</li> </ul> <h3 id="wady">Wady:</h3> <ul> <li>âŒ <strong>Tylko w PHP 8.1+</strong> â€“ jeÅ›li utknÄ…Å‚eÅ› na 7.4, to pozostaje ci tylko pÅ‚akaÄ‡ w kÄ…cie.</li> <li>âŒ <strong>TrochÄ™ magii</strong> â€“ przy duÅ¼ych projektach musisz dobrze przemyÅ›leÄ‡, czy uÅ¼ywaÄ‡ <code class="language-plaintext highlighter-rouge">value</code> czy <code class="language-plaintext highlighter-rouge">name</code>.</li> <li>âŒ <strong>Overkill dla prostych przypadkÃ³w</strong> â€“ jak masz 2 wartoÅ›ci na krzyÅ¼, to moÅ¼e wystarczyÄ‡ <code class="language-plaintext highlighter-rouge">const</code>.</li> </ul> <hr/> <h2 id="-dlaczego-backedenums-dla-stringÃ³w-mogÄ…-byÄ‡-kÅ‚opotliwe">ğŸ˜… Dlaczego <code class="language-plaintext highlighter-rouge">BackedEnums</code> dla stringÃ³w mogÄ… byÄ‡ kÅ‚opotliwe?</h2> <p>No wÅ‚aÅ›nie, tutaj miaÅ‚em maÅ‚Ä… zagwozdkÄ™.<br/> JeÅ¼eli <strong>wartoÅ›Ä‡ enuma = jego nazwa</strong>, to trochÄ™ strzelamy sobie w kolano, bo potem w kodzie mamy:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nc">Status</span><span class="o">::</span><span class="k">NEW</span><span class="o">-</span><span class="n">value</span> <span class="c1">// "NEW"</span>
 <span class="nc">Status</span><span class="o">::</span><span class="k">NEW</span><span class="o">-</span><span class="n">name</span>  <span class="c1">// "NEW"</span>
</code></pre></div></div> <p>A skoro moÅ¼na po prostu uÅ¼ywaÄ‡ <code class="language-plaintext highlighter-rouge">-name</code>, to po co nam to caÅ‚e <code class="language-plaintext highlighter-rouge">value</code>?<br/> Zamiast tego lepiej zostawiÄ‡ zwykÅ‚e <code class="language-plaintext highlighter-rouge">enum</code> (bez wartoÅ›ci) i mieÄ‡ spokÃ³j.</p> <h2 id="-a-co-byÅ‚o-przed-enumami">â³ A co byÅ‚o przed enumami?</h2> <p>Ach, stare dobre czasyâ€¦<br/> PisaliÅ›my takie kwiatki:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Status</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">NEW</span> <span class="o">=</span> <span class="s1">'new'</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">IN_PROGRESS</span> <span class="o">=</span> <span class="s1">'in_progress'</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">DONE</span> <span class="o">=</span> <span class="s1">'done'</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$status</span> <span class="o">=</span> <span class="nc">Status</span><span class="o">::</span><span class="k">NEW</span><span class="p">;</span>
</code></pre></div></div> <p>Albo jeszcze lepiej â€“ <strong>tablice mapperÃ³w</strong>, ktÃ³re trzeba byÅ‚o utrzymywaÄ‡ w 3 miejscach naraz.<br/> (Tak, wszyscy wiemy, Å¼e to bolaÅ‚o).</p> <hr/> <h2 id="-before--after--czyli-jak-siÄ™-pozbyÅ‚em-mapperÃ³w">ğŸ”„ Before &amp; After â€“ czyli jak siÄ™ pozbyÅ‚em mapperÃ³w</h2> <p><strong>Przed (mappery):</strong></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">OrderStatus</span> <span class="p">{</span>
   <span class="k">public</span> <span class="k">const</span> <span class="no">NEW</span> <span class="o">=</span> <span class="s1">'new'</span><span class="p">;</span>
   <span class="k">public</span> <span class="k">const</span> <span class="no">IN_PROGRESS</span> <span class="o">=</span> <span class="s1">'in_progress'</span><span class="p">;</span>
   <span class="k">public</span> <span class="k">const</span> <span class="no">DONE</span> <span class="o">=</span> <span class="s1">'done'</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">static</span> <span class="kt">array</span> <span class="nv">$labels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="k">self</span><span class="o">::</span><span class="k">NEW</span> <span class="o">=</span> <span class="s2">"I'm doing things now!"</span><span class="p">,</span>
        <span class="k">self</span><span class="o">::</span><span class="no">IN_PROGRESS</span> <span class="o">=</span> <span class="s2">"I'm working on it!"</span><span class="p">,</span>
        <span class="k">self</span><span class="o">::</span><span class="no">DONE</span> <span class="o">=</span> <span class="s2">"I finished"</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>

<span class="k">echo</span> <span class="nc">OrderStatus</span><span class="o">::</span><span class="nv">$labels</span><span class="p">[</span><span class="nc">OrderStatus</span><span class="o">::</span><span class="no">IN_PROGRESS</span><span class="p">];</span> <span class="c1">// "I'm working on it!"</span>
</code></pre></div></div> <p><strong>Po (enumy):</strong></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">enum</span> <span class="nc">OrderStatus</span><span class="o">:</span> <span class="n">string</span> <span class="p">{</span>
    <span class="k">case</span> <span class="k">NEW</span> <span class="o">=</span> <span class="s1">'new'</span><span class="p">;</span>
    <span class="k">case</span> <span class="no">IN_PROGRESS</span> <span class="o">=</span> <span class="s1">'in_progress'</span><span class="p">;</span>
    <span class="k">case</span> <span class="no">DONE</span> <span class="o">=</span> <span class="s1">'done'</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">label</span><span class="p">():</span> <span class="kt">string</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">match</span><span class="p">(</span><span class="nv">$this</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">::</span><span class="k">NEW</span> <span class="o">=</span> <span class="s2">"I'm doing things now!"</span><span class="p">,,</span>
            <span class="k">self</span><span class="o">::</span><span class="no">IN_PROGRESS</span> <span class="o">=</span> <span class="s2">"I'm working on it!"</span><span class="p">,</span>
            <span class="k">self</span><span class="o">::</span><span class="no">DONE</span> <span class="o">=</span> <span class="s2">"I finished"</span><span class="p">,</span>
        <span class="p">};</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">echo</span> <span class="nc">OrderStatus</span><span class="o">::</span><span class="no">IN_PROGRESS</span><span class="o">-&gt;</span><span class="nf">label</span><span class="p">();</span> <span class="c1">// "I'm working on it!"</span>
</code></pre></div></div> <p>Rezultat? Mappery out, kod jest czytelniejszy, a IDE podpowiada mi wszystko na bieÅ¼Ä…co. ğŸ˜<br/> PrzykÅ‚ad jest ciut abstrakcyjny, ale mimo wszystko oddaje problemy, z ktÃ³rymi naleÅ¼y sobie radziÄ‡.</p> <hr/> <h2 id="-moja-maÅ‚a-rewolucja">ğŸ‰ Moja maÅ‚a rewolucja</h2> <p>DziÄ™ki enumom udaÅ‚o mi siÄ™ pozbyÄ‡ caÅ‚ych mapperÃ³w wartoÅ›ci!<br/> Teraz kod jest czytelniejszy, IDE podpowiada mi wartoÅ›ci, a ja Å›piÄ™ spokojnie. ğŸ›Œ</p> <p>Mappery? <strong>Nie, dziÄ™kujÄ™.</strong><br/> Enumy przejÄ™Å‚y paÅ‚eczkÄ™ i zrobiÅ‚y to lepiej.<br/> I serio â€“ warto byÅ‚o to zrobiÄ‡. ğŸ˜</p> <hr/> <h2 id="-podsumowanie">ğŸ“Œ Podsumowanie</h2> <ul> <li>PHP 8.1 daÅ‚o nam <strong>enumy</strong> i <strong>BackedEnums</strong>.</li> <li>UÅ¼ywaj BackedEnums, gdy potrzebujesz <em>mapowania</em> nazw na wartoÅ›ci (<code class="language-plaintext highlighter-rouge">int</code>, <code class="language-plaintext highlighter-rouge">string</code>).</li> <li>Gdy <code class="language-plaintext highlighter-rouge">value == name</code> â€“ rozwaÅ¼ zwykÅ‚e <code class="language-plaintext highlighter-rouge">enum</code>.</li> <li>Enumy = mniej bugÃ³w, mniej mapperÃ³w, wiÄ™cej spokoju w duszy.</li> </ul> <p><strong>MoraÅ‚:</strong> Enumy to takie nowe <code class="language-plaintext highlighter-rouge">consty</code>, tylko Å‚adniejsze i mÄ…drzejsze.<br/> Mappery moÅ¼esz teraz wysÅ‚aÄ‡ na emeryturÄ™. ğŸ–ï¸</p> <hr/> <p>âœï¸ <strong>PS:</strong> Tak, uÅ›miechaÅ‚em siÄ™, piszÄ…c ten post. Bo naprawdÄ™ cieszÄ™ siÄ™, Å¼e w koÅ„cu mamy porzÄ…dne enumy w PHP. â¤ï¸</p>]]></content><author><name></name></author><category term="php"/><summary type="html"><![CDATA[ğŸ† BackedEnums w PHP â€“ czyli jak skoÅ„czyÅ‚em z mapperami i pokochaÅ‚em enumy â¤ï¸]]></summary></entry><entry><title type="html">Funkcje tablicowe: inicjalizacja tablicy przy pomocy [â€¦] lub array()? - PrzeglÄ…d PHP #2</title><link href="https://ziumper.github.io/pl/blog/2025/PHP-array-or-brackets/" rel="alternate" type="text/html" title="Funkcje tablicowe: inicjalizacja tablicy przy pomocy [â€¦] lub array()? - PrzeglÄ…d PHP #2"/><published>2025-03-24T00:00:00+00:00</published><updated>2025-03-24T00:00:00+00:00</updated><id>https://ziumper.github.io/blog/2025/PHP-array-or-brackets</id><content type="html" xml:base="https://ziumper.github.io/blog/2025/PHP-array-or-brackets/"><![CDATA[<p>Jest to kolejna seria z cyklu PHP review. Tym razem postanowÅ‚em przyjrzeÄ‡ siÄ™ trochÄ™ bliÅ¼ej funkcji deklarujÄ…cej array i co siÄ™ za niÄ… tak naprawdÄ™ kryje. Z tego co pamiÄ™tam zapis <code class="language-plaintext highlighter-rouge">array()</code> przez moich kolegÃ³w z pracy uznawany byÅ‚ za zaÅ¼yÅ‚oÅ›Ä‡ i nie powinno siÄ™ juÅ¼ go uÅ¼ywaÄ‡. Aby siÄ™ o tym przekonaÄ‡ postanowiÅ‚em zaciÄ…gnÄ…Ä‡ repozytorium frameworka do refaktoryzacji i aktualizacji kodu PHP, czyli Rectora. No, bo jakie narzÄ™dzie najlepiej operuje na tablicach jak nie narzÄ™dzie do jego refaktoryzacji i bÄ™dzie trzymaÄ‡ siÄ™ najlepszych praktyk tworzenia i pisania kodu?</p> <h2 id="kolejne-gÅ‚Ä™bokie-zanurzenie-w-pÅ‚ycizne">Kolejne gÅ‚Ä™bokie zanurzenie w pÅ‚ycizne</h2> <p>Ku mojemu zdziwieniu nie znalazÅ‚em zbyt duÅ¼o przykÅ‚adÃ³w. Nawiasem mÃ³wiÄ…c jedynym przykÅ‚adem, ktÃ³ry rzeczywiÅ›cie zostaÅ‚a uÅ¼yta funkcja <code class="language-plaintext highlighter-rouge">array()</code> albo raczej jej dokumentacja, Å¼eby jej nie uÅ¼ywaÄ‡ :-). w frameworku Rector, byÅ‚a zÅ‚ota zasada dla <a href="https://github.com/rectorphp/rector/blob/59ca5ad3cdd75183ef65f6929693903f2f2a1717/rules/Php54/Rector/Array_/LongArrayToShortArrayRector.php#L30">LongArrayToShortArray</a></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">getRuleDefinition</span><span class="p">()</span> <span class="p">:</span> <span class="kt">RuleDefinition</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">RuleDefinition</span><span class="p">(</span><span class="s1">'Long array to short array'</span><span class="p">,</span> <span class="p">[</span><span class="k">new</span> <span class="nc">CodeSample</span><span class="p">(</span><span class="sh">&lt;&lt;&lt;'CODE_SAMPLE'
class SomeClass
{
    public function run()
    {
        return array();
    }
}
CODE_SAMPLE</span>
<span class="p">,</span> <span class="sh">&lt;&lt;&lt;'CODE_SAMPLE'
class SomeClass
{
    public function run()
    {
        return [];
    }
}
CODE_SAMPLE</span>
<span class="p">)]);</span>
</code></pre></div></div> <p>To daje do myÅ›lenia. ZwaÅ¼ajÄ…c na to, Å¼e metoda klasy <code class="language-plaintext highlighter-rouge">LongArrayToShortArrayRector.php</code> zostaÅ‚a umieszczona w pakiecie <code class="language-plaintext highlighter-rouge">Php54</code>. W wersji <strong>PHP5.4</strong> zostaÅ‚ dodany krÃ³tki operator tablicowy. Od tamej pory poleca siÄ™ uÅ¼ywaÄ‡, krÃ³tszej wersji zapisu tablicy.</p> <p>To nadal nie odpowiada do koÅ„ca na pytanie, jaka jest zasadnicza rÃ³Å¼nica pomiÄ™dzy wywoÅ‚aniem <code class="language-plaintext highlighter-rouge">array()</code> a <code class="language-plaintext highlighter-rouge">[ ]</code>. A wiec co naprawdÄ™ dzieje siÄ™ za kulisami? W momencie odpaleniu skryptu PHP trzeba najpierw upiec placekâ€¦ aby upiec placek trzeba:</p> <figure> <iframe src="https://www.youtube.com/embed/oVSGrY4DfUg" class="rounded z-depth-1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="" width="100%" height="500px"></iframe> </figure> <h2 id="stworzyÄ‡-abstract-syntax-tree-czyli-placek">StworzyÄ‡ Abstract Syntax Tree, czyli placek</h2> <p>Tak naprawdÄ™ wystarczy zrozumieÄ‡ AST - Abstract Syntax Tree. Jest to struktura drzewiasta, ktÃ³ra jest konieczna, aby oddzieliÄ‡ proces kompilacji od parsera. <a href="https://en.wikipedia.org/wiki/Lexical_analysis">Lexer</a> zwraca tokeny, ktÃ³re pÃ³Åºniej sÄ… przetwarzane przez parser zwracajÄ…cy strukturÄ™ ast, ktÃ³ra pÃ³Åºniej przechodzi kompilacje i na Å›wiat przychodzi â€œplacekâ€ w postaci kodÃ³w opcode umieszczonych w opcache, a one pÃ³Åºniej mogÄ… zostaÄ‡ zrozumiane przez komputer jako ciÄ…g wykonywalnych instrukcji. Aby dowiedzieÄ‡ siÄ™ wiÄ™cej na ten temat polecam obejrzeÄ‡ poniÅ¼szy materiaÅ‚ video:</p> <blockquote> <p><a href="https://www.youtube.com/watch?v=MWITYIWyowk">Climbing the Abstract Syntax Tree - James Titcumb - Forum PHP 2017</a></p> </blockquote> <h2 id="no-dobra-gdzie-w-takim-razie-wystÄ™puje-rÃ³Å¼nica-pomiÄ™dzy--a-array">No dobra, gdzie w takim razie wystÄ™puje rÃ³Å¼nica pomiÄ™dzy <code class="language-plaintext highlighter-rouge">[]</code> a <code class="language-plaintext highlighter-rouge">array()</code>?</h2> <p>Pierwsza rÃ³Å¼nica, ktÃ³rÄ… zauwaÅ¼yÅ‚em byÅ‚a w <a href="https://github.com/php/php-src/blob/master/Zend/zend_compile.h#L1044">kompilatorze</a>. MoÅ¼na Å‚atwo zauwaÅ¼yÄ‡, Å¼e zapis zostaÅ‚ oddzielony na skÅ‚adniÄ… dÅ‚ugÄ… oraz krÃ³tkÄ….</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#define ZEND_ARRAY_SYNTAX_LIST 1  /* list() */
#define ZEND_ARRAY_SYNTAX_LONG 2  /* array() */
#define ZEND_ARRAY_SYNTAX_SHORT 3 /* [] */
</code></pre></div></div> <p>oraz w przypadku walidacji przypisania</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="kt">void</span> <span class="nf">zend_verify_list_assign_target</span><span class="p">(</span><span class="n">zend_ast</span> <span class="o">*</span><span class="n">var_ast</span><span class="p">,</span> <span class="n">zend_ast_attr</span> <span class="n">array_style</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">var_ast</span><span class="o">-&gt;</span><span class="n">kind</span> <span class="o">==</span> <span class="n">ZEND_AST_ARRAY</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">var_ast</span><span class="o">-&gt;</span><span class="n">attr</span> <span class="o">==</span> <span class="n">ZEND_ARRAY_SYNTAX_LONG</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">zend_error_noreturn</span><span class="p">(</span><span class="n">E_COMPILE_ERROR</span><span class="p">,</span> <span class="s">"Cannot assign to array(), use [] instead"</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">array_style</span> <span class="o">!=</span> <span class="n">var_ast</span><span class="o">-&gt;</span><span class="n">attr</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">zend_error_noreturn</span><span class="p">(</span><span class="n">E_COMPILE_ERROR</span><span class="p">,</span> <span class="s">"Cannot mix [] and list()"</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">zend_can_write_to_variable</span><span class="p">(</span><span class="n">var_ast</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">zend_error_noreturn</span><span class="p">(</span><span class="n">E_COMPILE_ERROR</span><span class="p">,</span> <span class="s">"Assignments can only happen to writable values"</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>W kodzie php ma to nastÄ™pujÄ…ce konsekwencje:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">];</span>  <span class="c1">// BÅ‚Ä…d: nie moÅ¼na przypisaÄ‡ do array()</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">];</span>  <span class="c1">// Poprawne</span>
</code></pre></div></div> <p>Szczerze, nie spodziewaÅ‚em siÄ™ spotkaÄ‡ takich kruczkÃ³w w kompilatorze, ale jest to pewna znaczÄ…ca rÃ³Å¼nica.</p> <p>Kolejna rÃ³Å¼nica jest widoczna w tak zwanym <a href="https://en.wikipedia.org/wiki/Lexical_analysis">Lexerze</a>. w pliku <a href="https://github.com/php/php-src/blob/master/Zend/zend_language_scanner.l#L1764C1-L1766C2">language_scanner.l</a></p> <pre><code class="language-lexer">&lt;ST_IN_SCRIPTING&gt;"array" {
	RETURN_TOKEN_WITH_IDENT(T_ARRAY);
}

&lt;ST_IN_SCRIPTING&gt;"["|"(" {
	enter_nesting(yytext[0]);
	RETURN_TOKEN(yytext[0]);
}

&lt;ST_IN_SCRIPTING&gt;"]"|")" {
	/* Check that ] and ) match up properly with a preceding [ or ( */
	RETURN_EXIT_NESTING_TOKEN(yytext[0]);
}

</code></pre> <h2 id="jakie-wnioski-moÅ¼na-wysunÄ…Ä‡">Jakie wnioski moÅ¼na wysunÄ…Ä‡?</h2> <ul> <li>W przypadku <code class="language-plaintext highlighter-rouge">[]</code> lexer musi zwrÃ³ciÄ‡ dwa tokeny, a parser potem Å‚Ä…czy je w odpowiedniÄ… strukturÄ™. To wymaga wiÄ™cej pracy w fazie tokenizacji i parsowania w porÃ³wnaniu do <code class="language-plaintext highlighter-rouge">array()</code>, gdzie lexer zwraca gotowy token <code class="language-plaintext highlighter-rouge">T_ARRAY</code>, a parser tylko przetwarza go jako jedno wyraÅ¼enie. Musi wykonaÄ‡ dodatkowe kroki, aby sprawdziÄ‡, czy to tablica, analizujÄ…c dokÅ‚adniej. Zatem w przypadku <code class="language-plaintext highlighter-rouge">[]</code> parser musi dÅ‚uÅ¼ej analizowaÄ‡ kod. GdyÅ¼ zczytywanie struktur AST odbywa siÄ™ znak po znaku, w odwrÃ³conej <a href="https://en.wikipedia.org/wiki/Reverse_Polish_notation">notacji polskiej</a>.</li> <li>Wersja PHP bez opcache wymaga kaÅ¼dorazowego przetwarzania kodu w czasie wykonywania. Oznacza to, Å¼e kaÅ¼de wywoÅ‚anie kodu w PHP, zarÃ³wno array(), jak i [], wymaga zwrÃ³cenia siÄ™ do lexera i parsera w celu wygenerowania AST i opcodÃ³w.</li> <li>DÅ‚uÅ¼szy czas parsowania dla []: PoniewaÅ¼ [] wymaga dodatkowej analizy przez parsera (musi rozpoznaÄ‡ nawiasy), przetwarzanie zajmuje wiÄ™cej czasu.</li> <li>KrÃ³tszy czas dla array(): Token `T_ARRAY jest prostszy do rozpoznania i parser nie musi przeprowadzaÄ‡ dodatkowej analizy skÅ‚adniowej. Proces parsowania jest szybszy dla T_ARRAY, ale tylko, gdy nie uÅ¼ywa siÄ™ opcache.</li> </ul> <p>No i kto by pomyÅ›laÅ‚, Å¼eby okreÅ›liÄ‡, jaka jest prawdziwa rÃ³Å¼nica pomiÄ™dzy <code class="language-plaintext highlighter-rouge">[ ]</code> i <code class="language-plaintext highlighter-rouge">array()</code> bÄ™dÄ™ zmuszony wgÅ‚Ä™biÄ‡ siÄ™ aÅ¼ tak bardzo w php. Wydaje siÄ™, Å¼e nadal wywoÅ‚anie funkcji <code class="language-plaintext highlighter-rouge">array()</code> moÅ¼e mieÄ‡ pewne zastosowania.</p> <ul> <li>kiedy za kaÅ¼dym kompiluje siÄ™ kod bez dostÄ™pu do pamiÄ™ci tymczasowej opcache, co jest raczej rzadkoÅ›ciÄ….</li> <li>funkcja <code class="language-plaintext highlighter-rouge">eval()</code> w ktÃ³rej oppcache nie jest wykorzystywany.</li> </ul> <h2 id="waÅ¼ne-linki">WaÅ¼ne Linki</h2> <ul> <li><a href="https://github.com/php/php-src/tree/master">The PHP Interpreter</a></li> <li><a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">AST</a></li> <li><a href="https://www.php.net/manual/en/opcache.preloading.php">OpCache Preloading</a></li> </ul>]]></content><author><name></name></author><category term="php"/><summary type="html"><![CDATA[Czy deklarowanie tablicy za pomocÄ… sÅ‚owa array() idzie na Å›mietnik historii? Co ma wspÃ³lnego pieczenie placka z kompilacjÄ… kodu?]]></summary></entry><entry><title type="html">Funkcje tablicowe: [â€˜array_filterâ€™,â€™array_mergeâ€™] - PrzeglÄ…d PHP #1</title><link href="https://ziumper.github.io/pl/blog/2025/PHP-array-functions-overview_array_filter_array_map/" rel="alternate" type="text/html" title="Funkcje tablicowe: [â€˜array_filterâ€™,â€™array_mergeâ€™] - PrzeglÄ…d PHP #1"/><published>2025-03-12T00:00:00+00:00</published><updated>2025-03-12T00:00:00+00:00</updated><id>https://ziumper.github.io/blog/2025/PHP-array-functions-overview_array_filter_array_map</id><content type="html" xml:base="https://ziumper.github.io/blog/2025/PHP-array-functions-overview_array_filter_array_map/"><![CDATA[<p>Rozpoczynam cykl, w ktÃ³rym robiÄ™ przeglÄ…d najbardziej uÅ¼ytecznych funkcji PHP i jak najefektywniej z nich korzystaÄ‡. Nie ma to jak dobra Å›ciÄ…ga przed rozmowÄ… kwalifikacyjnÄ…. Cykl jest podytkowany tym, Å¼e ostatnio w PHP bardzo duÅ¼o siÄ™ zadziaÅ‚o, najnowsze wersje PHP sporo zamieszaÅ‚y, a dobrze jest odÅ›wieÅ¼yÄ‡ sobie wiedze i zrobiÄ‡ sobie porzÄ…dne notatki, nie wspominajÄ…c juÅ¼ o tym, Å¼e trzeba nadgoniÄ‡!</p> <h2 id="przykÅ‚ady-z-repozytorium-wziÄ™te">PrzykÅ‚ady z repozytorium wziÄ™te</h2> <p>JuÅ¼ sama nazwa <code class="language-plaintext highlighter-rouge">Funkcje tablicowe</code> powoduje konsternacje. W internecie moÅ¼na napotkaÄ‡ na ogrom przykÅ‚adÃ³w zarÃ³wno tych lepszych jak i gorszych. Z funkcji jak korzystaÄ‡ kaÅ¼dy pierwszy junior wie, dlatego postanowiÅ‚em zagÅ‚Ä™biÄ‡ siÄ™ w temat trochÄ™ gÅ‚Ä™biej i poszukaÄ‡ ich zastosowania w kilku popularnych frameworkach PHP z ktÃ³rymi miaÅ‚em stycznoÅ›Ä‡ w pracy programisty:</p> <ul> <li><a href="https://github.com/symfony/symfony">Symfony</a> - platforma, ktÃ³ra zasÅ‚uguje na miano najbardziej dojrzaÅ‚ej biznesowo pod wzglÄ™dem kompatybilnoÅ›ci i przypadkÃ³w uÅ¼ycia. Na pewno znajdÄ™ w Å›rodku jakieÅ› ciekawe Ä‡wieki.</li> <li><a href="https://github.com/laravel/laravel">Laravel</a> - w przeciwieÅ„stwie do Symfony tutaj wszystko zmienia siÄ™ szybko z wersji na wersje, ale ma to teÅ¼ swoje plusy, bo szybko moÅ¼emy zbudowaÄ‡ prototyp. Gdzie jak nie tam ondajdÄ™ naprawdÄ™ sporo ciekawych zastosowaÅ„ funkcji tablicowych.</li> <li><a href="https://github.com/rectorphp/rector">Rector</a> - Moje ulubione narzÄ™dzie do pracy z starym kodem php. MyÅ›lÄ™, Å¼e moÅ¼e caÅ‚kiem nieÅºle pokazaÄ‡ zastosowania funkcji tablicowych.</li> </ul> <h2 id="przykÅ‚ad-z-array_filter">PrzykÅ‚ad z array_filter</h2> <p>WypÅ‚ynÄ…Å‚em na otwarty przestwÃ³r oceanu kodu php i jak na ironiÄ™ od razu wpadÅ‚em na gÃ³rÄ™ lodowÄ…. PierwszÄ… klasÄ… z brzega byÅ‚a <a href="https://github.com/symfony/symfony/blob/7.2/src/Symfony/Bridge/Doctrine/ArgumentResolver/EntityValueResolver.php">EntityValueResolver</a> implementujÄ…ca interfejs <a href="https://github.com/symfony/symfony/blob/7.3/src/Symfony/Component/HttpKernel/Controller/ValueResolverInterface.php">ValueResolverInterface</a>. Klasa <a href="https://github.com/symfony/symfony/blob/7.2/src/Symfony/Bridge/Doctrine/ArgumentResolver/EntityValueResolver.php">EntityValueResolver</a> jest odpowiedzialna za automatyczne przekazywanie encji do kontrolera na podstawie identyfikatora podanego w Å›cieÅ¼ce URL. PrzykÅ‚adowo mogÄ™ zdefiniowaÄ‡ taki krÃ³tki kod:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">#[Route('/user/{id}', name: 'user_show')]</span>
<span class="k">public</span> <span class="k">function</span> <span class="n">show</span><span class="p">(</span><span class="kt">User</span> <span class="nv">$user</span><span class="p">):</span> <span class="kt">Response</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">Response</span><span class="p">(</span><span class="s1">'User: '</span> <span class="mf">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="nf">getUsername</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div></div> <p>w ktÃ³rym klasa <code class="language-plaintext highlighter-rouge">User</code> jest zmapowanÄ… encjÄ… bazodanowÄ… i zostanie ona automatycznie poddna procesowi hydracji, i zostanie zwrÃ³cona z bazy. Wiecej moÅ¼na poczytaÄ‡ o tym <a href="https://symfony.com/doc/current/doctrine.html#doctrine-entity-value-resolver">tutaj</a>. CaÅ‚kiem fajna funkcjonalnoÅ›Ä‡!</p> <p>JednakÅ¼e, wracajÄ…c kolokwialnie rzecz ujmujÄ…c do â€œbebechÃ³wâ€ i gÅ‚Ã³wnego tematu, czyli funkcji tablicowych.</p> <p>Funkcja <a href="https://www.php.net/manual/en/function.array-filter.php">array_filter</a>. UÅ¼yta w klasie <a href="https://github.com/symfony/symfony/blob/7.2/src/Symfony/Bridge/Doctrine/ArgumentResolver/EntityValueResolver.php#L178">EntityValueResolver</a></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">if</span> <span class="p">(</span><span class="nv">$options</span><span class="o">-&gt;</span><span class="n">stripNull</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$criteria</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nv">$criteria</span><span class="p">,</span> <span class="k">static</span> <span class="k">fn</span> <span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kc">null</span> <span class="o">!==</span> <span class="nv">$value</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p>PrzykÅ‚ad z <a href="https://symfony.com">Symfony</a> <a href="https://www.php.net/manual/en/function.array-filter.php">array_filter</a> - pozwala zwrÃ³ciÄ‡ nowÄ… tablice na podstawie obiektu <a href="https://www.php.net/manual/en/class.closure.php">Closure</a> czyli obiektu <a href="https://www.php.net/manual/en/functions.anonymous.php">funkcji anonimowej</a> zwracjÄ…cej wartoÅ›Ä‡ <code class="language-plaintext highlighter-rouge">true/false</code> dla kaÅ¼dego elementu jak tutaj w przykÅ‚adzie. Warto zwrÃ³ciÄ‡ uwagÄ™, Å¼e zostaÅ‚a ona uÅ¼yta tutaj jako funkcja <strong>statyczna</strong>. To jest akurat bardzo ciekawe poniewaÅ¼ jak czytamy z <a href="https://www.php.net/manual/en/functions.anonymous.php#functions.anonymous-functions.static">dokumentacji</a>:</p> <blockquote> <p>Anonymous functions may be declared statically. This prevents them from having the current class automatically bound to them. Objects may also not be bound to them at runtime.</p> </blockquote> <p>DziÄ™ki czemu blokowana jest moÅ¼liwoÅ›Ä‡ wykorzystania metody <a href="https://www.php.net/manual/en/closure.bindto.php">bindTo</a> z klasy [Closure](<a href="https://www.php.net/manual/en/class.closure.php">Closure</a>. W tym przypadku pojawia siÄ™ pytanie. Dlaczego powinno siÄ™ blokowaÄ‡ wywoÅ‚anie metody <a href="https://www.php.net/manual/en/closure.bindto.php">bindTo</a> dla funkcji anonimowych. Odpowiedzi moÅ¼e byÄ‡ kilka:</p> <p><strong>a)</strong> poniewaÅ¼ chcemy uniknÄ…Ä‡ niezamierzonego dostÄ™pu do <code class="language-plaintext highlighter-rouge">$this</code> w kontekÅ›cie klasy</p> <p><strong>b)</strong> poniewaÅ¼ chcemy zwiÄ™kszyÄ‡ wydajnoÅ›Ä‡ i uniknÄ…Ä‡ potencjalnych wyciekÃ³w pamiÄ™ci</p> <p><strong>c)</strong> poniewaÅ¼ nie chcemy, aby funkcja anonimowa mogÅ‚a byÄ‡ pÃ³Åºniej przypisana do innego obiektu i zmieniaÄ‡ jego stan dynamicznie</p> <p>Opcja <strong>a)</strong> jest tutaj szczegÃ³lnie istotna. Deklarowanie funkcji anonimowej jako <strong><a href="https://www.php.net/manual/en/language.oop5.static.php">static</a></strong> uniemoÅ¼liwia jej powiÄ…zanie z instancjÄ… klasy, co zapobiega przypadkowemu dostÄ™powi do <code class="language-plaintext highlighter-rouge">$this</code>. Jest to szczegÃ³lnie przydatne w przypadku czystych funkcji <a href="https://en.wikipedia.org/wiki/Pure_function">pure functions</a>, ktÃ³re nie powinny mieÄ‡ dostÄ™pu do stanu obiektu, w ktÃ³rym sÄ… wywoÅ‚ywane. Jest to najwidoczniej ukÅ‚on w stronÄ™ paradygmatÃ³w programowania funkcyjnego. Warto teÅ¼ zauwaÅ¼yÄ‡, Å¼e taki sposÃ³b deklaracji podpowiada, Å¼e funkcja anonimowa nie ma wpÅ‚ywu na klasÄ™, w ktÃ³rej zostaÅ‚a zadeklarowana i to prawdopodobnie autor miaÅ‚ na myÅ›li! W skrÃ³cie to dobra praktyka, ale nie koniecznoÅ›Ä‡.</p> <blockquote> <p>Dodanie <strong>static</strong> sprawia, Å¼e intencja jest jasna â€œta funkcja jest niezaleÅ¼na od instancji tej klasyâ€.</p> </blockquote> <h2 id="przykÅ‚ad-z-array_merge">PrzykÅ‚ad z array_merge</h2> <p>Funkcja <a href="https://www.php.net/manual/en/function.array-merge.php">array_merge</a> - dodaje elementy drugiej tablicy do koÅ„ca pierwszej tablicy w poniÅ¼szym <a href="https://github.com/symfony/symfony/blob/7.2/src/Symfony/Bridge/Doctrine/ArgumentResolver/EntityValueResolver.php#L223">przykÅ‚adzie</a> z <a href="https://symfony.com">Symfony</a></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$repository</span> <span class="o">=</span> <span class="nv">$manager</span><span class="o">-&gt;</span><span class="nf">getRepository</span><span class="p">(</span><span class="nv">$options</span><span class="o">-&gt;</span><span class="n">class</span><span class="p">);</span>
<span class="nv">$variables</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="n">attributes</span><span class="o">-&gt;</span><span class="nf">all</span><span class="p">(),</span> <span class="p">[</span>
    <span class="s1">'repository'</span> <span class="o">=&gt;</span> <span class="nv">$repository</span><span class="p">,</span>
    <span class="s1">'request'</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="p">,</span>
<span class="p">]);</span>
</code></pre></div></div> <p>Dobra, pora sprawdziÄ‡, jak moÅ¼na to napisaÄ‡ inaczej:</p> <ul> <li>Destrukturyzacja - zmieniam trochÄ™ strukturÄ™, przez co elementy dodane do tablicy z nadpisaniem istniejÄ…cych wczeÅ›niej wartoÅ›ci i usuwa rÃ³wnieÅ¼ potrzebÄ™ uÅ¼ycia <a href="https://www.php.net/manual/en/function.array-merge.php">array_merge</a> i zastÄ™puje jej uÅ¼ycie <a href="https://wiki.php.net/rfc/spread_operator_for_array">operatora odpakowujÄ…cego</a> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$variables</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mf">...</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">attributes</span><span class="o">-&gt;</span><span class="nf">all</span><span class="p">(),</span>
    <span class="s1">'repository'</span> <span class="o">=&gt;</span> <span class="nv">$repository</span><span class="p">,</span>
    <span class="s1">'request'</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="p">,</span>
<span class="p">];</span>
</code></pre></div> </div> </li> <li>BepoÅ›rednie przypisanie spowoduje nadpisanie zmiennych <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$variables</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="n">attributes</span><span class="o">-&gt;</span><span class="nf">all</span><span class="p">();</span>
<span class="nv">$variables</span><span class="p">[</span><span class="s1">'repository'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$repository</span><span class="p">;</span>
<span class="nv">$variables</span><span class="p">[</span><span class="s1">'request'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$request</span><span class="p">;</span>
</code></pre></div> </div> </li> <li> <p>UÅ¼ycie operatora union <code class="language-plaintext highlighter-rouge">+</code> W tym przypadku zmienne nie zostanÄ… nadpisane</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$variables</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="n">attributes</span><span class="o">-&gt;</span><span class="nf">all</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span>
    <span class="s1">'repository'</span> <span class="o">=&gt;</span> <span class="nv">$repository</span><span class="p">,</span>
    <span class="s1">'request'</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="p">,</span>
<span class="p">];</span>

<span class="c1">#or</span>
<span class="nv">$variables</span> <span class="o">+=</span> <span class="p">[</span>
    <span class="s1">'repository'</span> <span class="o">=&gt;</span> <span class="nv">$repository</span><span class="p">,</span>
    <span class="s1">'request'</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="p">,</span>
<span class="p">];</span>
</code></pre></div> </div> </li> </ul> <p>WedÅ‚ug mnie destrukturyzacja jest znacznie bardziej kuszÄ…ca, ale naleÅ¼y uwzglÄ™dniÄ‡ parÄ™ czynnikÃ³w ubocznych. Operator <code class="language-plaintext highlighter-rouge">...</code> podmieni klucze typu <code class="language-plaintext highlighter-rouge">int</code> nawet jak sÄ… typu string. W przypadku <code class="language-plaintext highlighter-rouge">+</code> klucze zostanÄ… zachowane. Dodatkowo operator <code class="language-plaintext highlighter-rouge">...</code> jest szybszy niÅ¼ <code class="language-plaintext highlighter-rouge">array_merge</code> i wspiera interfejs <code class="language-plaintext highlighter-rouge">Traversable</code> a przynajmniej powinien wedÅ‚ug <a href="https://wiki.php.net/rfc/spread_operator_for_array#advantages_over_array_merge">rfc</a>. Obstawiam wiÄ™c, Å¼e niedÅ‚ugo zobaczymy w kodzie wiÄ™cej uÅ¼yÄ‡ <code class="language-plaintext highlighter-rouge">...</code> zamiast wywoÅ‚aÅ„ funkcji <code class="language-plaintext highlighter-rouge">array_merge</code>, ale tylko pod jednym warunkiem. JeÅ¼eli klucze tablic nie bÄ™dÄ… wartoÅ›ci <code class="language-plaintext highlighter-rouge">int</code>, bo tylko wtedy <code class="language-plaintext highlighter-rouge">array_merge</code> jest szybsze niÅ¼ <code class="language-plaintext highlighter-rouge">...</code>.</p> <p>PodusmowujÄ…c:</p> <ul> <li><code class="language-plaintext highlighter-rouge">...</code> resetuje indeksy numeryczne (konwertuje teskty liczbowe na liczby i nadpisuje kolejnoÅ›Ä‡), dziaÅ‚a szybciej dla nienumerycznych kluczy.</li> <li><code class="language-plaintext highlighter-rouge">+</code> zachowuje klucze, ale nie nadpisuje istniejÄ…cych</li> <li><code class="language-plaintext highlighter-rouge">array_merge()</code>resetuje indeksy numeryczne podobnie jak <code class="language-plaintext highlighter-rouge">...</code>, ale podobno dziaÅ‚a szybciej dla normalnych kluczy numerycznych. WiÄ™cej moÅ¼na poczytaÄ‡ o tym <a href="https://www.php.net/manual/en/function.array-merge.php#126687">tutaj</a>.</li> </ul>]]></content><author><name></name></author><category term="php"/><summary type="html"><![CDATA[PrzeglÄ…d najczÄ™sciej wykorzystywanych funkcji w jÄ™zyku PHP do pracy z tablicami. Kiedy i jak ich uÅ¼ywaÄ‡ w optymalny sposÃ³b.]]></summary></entry><entry><title type="html">Testowanie obÅ‚sugi bÅ‚edÃ³w w Godocie przy pomocy GUT</title><link href="https://ziumper.github.io/pl/blog/2025/testing-error-handling-in-gdscript/" rel="alternate" type="text/html" title="Testowanie obÅ‚sugi bÅ‚edÃ³w w Godocie przy pomocy GUT"/><published>2025-03-06T00:00:00+00:00</published><updated>2025-03-06T00:00:00+00:00</updated><id>https://ziumper.github.io/blog/2025/testing-error-handling-in-gdscript</id><content type="html" xml:base="https://ziumper.github.io/blog/2025/testing-error-handling-in-gdscript/"><![CDATA[<p>Testowanie to z pewnoÅ›ciÄ… nieÅ‚atwe zadanie, zwÅ‚aszcza jeÅ¼eli chodzi o pisanie testÃ³w w silnikach gier. JednakÅ¼e, moÅ¼na siÄ™ posiÅ‚kowaÄ‡ juÅ¼ istniejÄ…cymi rozwiÄ…zaniami. Jednym z nich jest <a href="https://github.com/bitwes/Gut">GUT</a>, czyli Godot Unit Tests.</p> <h2 id="definicja-problemu">Definicja problemu:</h2> <p>Ostatnio natrafiÅ‚em w swoim projekcie na nastÄ™pujÄ…cy problem. ChciaÅ‚em przetestowaÄ‡ obsÅ‚ugÄ™ bÅ‚Ä™dÃ³w w swojej grze przy Å‚adowaniu zapisanego stanu gry.</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Reads the data from file and returns as dictionary
</span><span class="n">func</span> <span class="nf">load_data</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Dictionary</span><span class="p">:</span>
	<span class="n">var</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="n">var</span> <span class="n">path</span> <span class="o">=</span> <span class="nf">get_saved_game_path</span><span class="p">()</span>
	<span class="n">var</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">FileAccess</span><span class="p">.</span><span class="nf">open_encrypted_with_pass</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">FileAccess</span><span class="p">.</span><span class="n">READ</span><span class="p">,</span> <span class="n">_password</span><span class="p">)</span>
<span class="bp">...</span>
</code></pre></div></div> <p>SpojrzaÅ‚em przede wszystkim na dokumentacjÄ™ <code class="language-plaintext highlighter-rouge">FileAccess.get_open_error</code>. Zwraca ona typ <code class="language-plaintext highlighter-rouge">enum</code> Error. Sprawdzenie zwracanego kodu byÅ‚o dobrym tropem, ale najpierw naleÅ¼aÅ‚o napisaÄ‡ test:</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">func</span> <span class="nf">test_load_if_game_save_doesnt_exist</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">void</span><span class="p">:</span>
	<span class="n">var</span> <span class="n">save</span> <span class="o">=</span> <span class="n">GameSave</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="sh">"</span><span class="s">TestingGameSave.save</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">12345</span><span class="sh">"</span><span class="p">)</span>
	<span class="n">var</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dictionary</span> <span class="o">=</span> <span class="n">save</span><span class="p">.</span><span class="nf">load_data</span><span class="p">()</span>
	<span class="nf">assert_not_null</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></div> <p>To taki dobry poczÄ…tek. Sprawdzam najpierw, czy jest z czym pracowaÄ‡ i czy dane nie sÄ… przypadkiem nullem. MiaÅ‚em w gÅ‚owie kilka pomysÅ‚Ã³w, jak to powinno wyglÄ…daÄ‡. Przede wszystkim:</p> <ol> <li> <p>Nie zwracaj bÅ‚Ä™dÃ³w. Nie chciaÅ‚em zwracaÄ‡ wyjÄ…tkÃ³w i obsÅ‚ugiwaÄ‡ ich na zewnÄ…trz funkcji. ChciaÅ‚em po prostu dodaÄ‡ obsÅ‚ugÄ™ bÅ‚Ä™dÃ³w tam, gdzie one wystÄ™pujÄ…. W GDScript nie moÅ¼na uÅ¼ywaÄ‡ try-catch ani rzucaÄ‡ wyjÄ…tkami, co rÃ³wnieÅ¼ nie jest dobrÄ… praktykÄ…. Nie mam w zwyczaju zrzucaÄ‡ wszystkiego na inne osoby. WolÄ™ rozwiÄ…zywaÄ‡ problemy tam, gdzie rzeczywiÅ›cie wystÄ™pujÄ…, poniewaÅ¼ jest to najbardziej prawdopodobne miejsce, w ktÃ³rym moÅ¼na je rozwiÄ…zaÄ‡.</p> </li> <li> <p>Nie zwracaj wartoÅ›ci null. Jest to czÄ™sty problem, ktÃ³ry nazywam â€œpropagacjÄ… pustkiâ€. Problem polega na tym, Å¼e za kaÅ¼dym razem, gdy zwracamy null, umiera w nas czÄ…stka czÅ‚owieczeÅ„stwa. A przy kolejnym wywoÅ‚aniu funkcji, kiedy chcemy wywoÅ‚aÄ‡ metodÄ™ na obiekcie, musimy najpierw sprawdziÄ‡, czy nie jest on nullem, gdyÅ¼ w przeciwnym wypadku ryzukujujemy NullPointerException i najprawdopodbniej wyÅ‚Ä…czenie gry w trakcie rozgrywki. NaleÅ¼y wiÄ™c pozbyÄ‡ siÄ™ wartoÅ›ci null! TrochÄ™ szerzej ten problem zostaÅ‚ opisany <a href="https://hackernoon.com/null-the-billion-dollar-mistake-8t5z32d6">tutaj</a>.</p> </li> <li> <p>Nie wrzucaj wszystkiego do jednego worka. Zwracanie bÅ‚Ä™dÃ³w lub obiektu mogÅ‚oby wywoÅ‚aÄ‡ lawinÄ™ obsÅ‚ugi bÅ‚Ä™dÃ³w (patrz punkt 1). Im proÅ›ciej, tym lepiej â€“ dziÄ™ki temu Å‚atwiej bÄ™dzie mi pracowaÄ‡ nad tym w przyszÅ‚oÅ›ci.</p> </li> </ol> <h2 id="rozwiÄ…zanie">RozwiÄ…zanie:</h2> <p>PoskutkowaÅ‚em to nastÄ™pujÄ…cym kodem:</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Reads the data from file and returns as dictionary
</span><span class="n">func</span> <span class="nf">load_data</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Dictionary</span><span class="p">:</span>
	<span class="n">var</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="n">var</span> <span class="n">path</span> <span class="o">=</span> <span class="nf">get_saved_game_path</span><span class="p">()</span>
	<span class="n">var</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">FileAccess</span><span class="p">.</span><span class="nf">open_encrypted_with_pass</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">FileAccess</span><span class="p">.</span><span class="n">READ</span><span class="p">,</span> <span class="n">_password</span><span class="p">)</span>
	<span class="n">var</span> <span class="n">error</span><span class="p">:</span> <span class="n">Error</span> <span class="o">=</span> <span class="n">FileAccess</span><span class="p">.</span><span class="nf">get_open_error</span><span class="p">()</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">error</span> <span class="o">==</span> <span class="n">OK</span><span class="p">:</span>
		<span class="nf">push_error</span><span class="p">(</span><span class="sh">'</span><span class="s">There was an error while trying to open a file with following error code: </span><span class="sh">'</span> <span class="o">+</span> <span class="nf">var_to_str</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">data</span>
</code></pre></div></div> <p>WyglÄ…da to naprawdÄ™ dobrze, ale nadal nie jestem usatysfakcjonowany. ChciaÅ‚em przetestowaÄ‡ scenariusz, w ktÃ³rym wystÄ™puje bÅ‚Ä…d, a przy okazji nie wypisywaÄ‡ nic na konsolÄ™ w momencie wykonania testu, tylko wtedy, gdy problem siÄ™ rzeczywiÅ›cie pojawia, oraz obsÅ‚uÅ¼yÄ‡ zwracany przez Godot kod bÅ‚Ä™du. Te wszystkie punkty razem stanowiÄ… wyzwanie, zwÅ‚aszcza dla mÅ‚odego jÄ™zyka skryptowego, jakim jest GDScript. Oto, co takiego zrobiÅ‚em:</p> <ul> <li>uÅ¼yÅ‚em metody <a href="https://gut.readthedocs.io/en/latest/Stubbing.html#to-call-callable">stub z GUT</a>.</li> <li>musiaÅ‚em uÅ¼yÄ‡ <a href="https://gut.readthedocs.io/en/latest/Partial-Doubles.html">partial double</a>ze wzglÄ™du na wsparcie metody stub dla obiektÃ³w klasy <code class="language-plaintext highlighter-rouge">double</code></li> <li> <p>Niestety, nie moÅ¼na nadpisywaÄ‡ implementacji sÅ‚owa kluczowego <code class="language-plaintext highlighter-rouge">push_error</code>, wiÄ™c napisaÅ‚em wÅ‚asnÄ… metodÄ™ <code class="language-plaintext highlighter-rouge">print_error</code> i wywoÅ‚aÅ‚em w jej wnÄ™trzu oryginalnÄ… metodÄ™, aby jÄ… zastÄ…piÄ‡ funkcjÄ… anonimowÄ…, ktÃ³ra z kolei ustawiaÅ‚a by flagÄ™ sprawdzajÄ…cÄ…, czy metoda zostaÅ‚a poprawnie wywoÅ‚ana. MyÅ›lÄ™, Å¼e w przyszÅ‚oÅ›ci do <a href="https://gut.readthedocs.io/en/latest/Stubbing.html#to-call-callable">stub</a> przydaÅ‚aby siÄ™ moÅ¼liwoÅ›Ä‡ sprawdzenia czy metdoa zostaÅ‚a na pewno wywoÅ‚ana. PÃ³ki co musiaÅ‚em siÄ™ posiÅ‚kowaÄ‡ zmiennÄ… globalnÄ….</p> <p>PrzeszukaÅ‚em dokumentacje GUT i znalazÅ‚em sposÃ³b, Å¼eby to sprawdziÄ‡ przy pomocy nastÄ™pujÄ…cej funkcji o ile klasa sprawdzajÄ…ca jest podklasÄ… klasy stub.</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">assert_called</span><span class="p">(</span><span class="n">save</span><span class="p">,</span><span class="sh">"</span><span class="s">print_error</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div> </div> </li> </ul> <p>CaÅ‚y kod prezentuje siÄ™ nastÄ™pujÄ…co:</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#game_save.gd
#wrapper for testing the errors
</span><span class="n">func</span> <span class="nf">print_error</span><span class="p">(</span><span class="n">msg</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">void</span><span class="p">:</span>
	<span class="nf">push_error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

<span class="c1">## Reads the data from file and returns as dictionary
</span><span class="n">func</span> <span class="nf">load_data</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Dictionary</span><span class="p">:</span>
	<span class="n">var</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="n">var</span> <span class="n">path</span> <span class="o">=</span> <span class="nf">get_saved_game_path</span><span class="p">()</span>
	<span class="n">var</span> <span class="nb">file</span> <span class="o">=</span> <span class="n">FileAccess</span><span class="p">.</span><span class="nf">open_encrypted_with_pass</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">FileAccess</span><span class="p">.</span><span class="n">READ</span><span class="p">,</span> <span class="n">_password</span><span class="p">)</span>
	<span class="n">var</span> <span class="n">error</span><span class="p">:</span> <span class="n">Error</span> <span class="o">=</span> <span class="n">FileAccess</span><span class="p">.</span><span class="nf">get_open_error</span><span class="p">()</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">error</span> <span class="o">==</span> <span class="n">OK</span><span class="p">:</span>
		<span class="nf">print_error</span><span class="p">(</span><span class="sh">'</span><span class="s">There was an error while trying to open a file with following error code: </span><span class="sh">'</span> <span class="o">+</span> <span class="nf">var_to_str</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">data</span>

<span class="c1">#test_game_save.gd
</span><span class="n">extends</span> <span class="n">GutTest</span>

<span class="n">var</span> <span class="n">_error_called</span> <span class="o">=</span> <span class="n">false</span>

<span class="n">func</span> <span class="nf">test_load_if_game_save_doesnt_exist</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">void</span><span class="p">:</span>
	<span class="c1">#arrange
</span>	<span class="n">var</span> <span class="n">save</span> <span class="o">=</span> <span class="nf">partial_double</span><span class="p">(</span><span class="n">GameSave</span><span class="p">).</span><span class="nf">new</span><span class="p">(</span><span class="sh">"</span><span class="s">TestingGameSave.save</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">12345</span><span class="sh">"</span><span class="p">)</span>

	<span class="nf">stub</span><span class="p">(</span><span class="n">save</span><span class="p">,</span><span class="sh">"</span><span class="s">print_error</span><span class="sh">"</span><span class="p">).</span><span class="nf">to_call</span><span class="p">(</span><span class="nf">func</span><span class="p">(</span><span class="n">_msg</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">void</span><span class="p">:</span>
		<span class="n">_error_called</span> <span class="o">=</span> <span class="n">true</span>
	<span class="p">)</span>

	<span class="c1">#act
</span>	<span class="n">var</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dictionary</span> <span class="o">=</span> <span class="n">save</span><span class="p">.</span><span class="nf">load_data</span><span class="p">()</span>

	<span class="c1">#assert
</span>	<span class="nf">assert_true</span><span class="p">(</span><span class="n">_error_called</span><span class="p">)</span> <span class="c1"># this one is custom solution for checks
</span>        <span class="nf">assert_called</span><span class="p">(</span><span class="n">save</span><span class="p">,</span><span class="sh">"</span><span class="s">print_error</span><span class="sh">"</span><span class="p">)</span> <span class="c1"># this one comes from gut
</span>	<span class="nf">assert_not_null</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></div> <h2 id="szczegÃ³Å‚y-rozwiÄ…zania">SzczegÃ³Å‚y rozwiÄ…zania:</h2> <p>NaleÅ¼y jednak wziÄ…c pod uwagÄ™, to, Å¼e wywoÅ‚anie funkcji anonimowej musiaÅ‚o odbyÄ‡ siÄ™ na zmiennej <code class="language-plaintext highlighter-rouge">_error_called</code> obiektu klasy. W GDscript obecny jest nastÄ™pujÄ…cy problem. JeÅ¼eli chciaÅ‚bym wywoÅ‚ac zmiennÄ… w taki sposÃ³b:</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">func</span> <span class="nf">test_load_if_game_save_doesnt_exist</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">void</span><span class="p">:</span>
	<span class="c1">#arrange
</span>	<span class="n">var</span> <span class="n">save</span> <span class="o">=</span> <span class="nf">partial_double</span><span class="p">(</span><span class="n">GameSave</span><span class="p">).</span><span class="nf">new</span><span class="p">(</span><span class="sh">"</span><span class="s">TestingGameSave.save</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">12345</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">var</span> <span class="n">error_called</span> <span class="o">=</span> <span class="n">true</span>

	<span class="nf">stub</span><span class="p">(</span><span class="n">save</span><span class="p">,</span><span class="sh">"</span><span class="s">print_error</span><span class="sh">"</span><span class="p">).</span><span class="nf">to_call</span><span class="p">(</span><span class="nf">func</span><span class="p">(</span><span class="n">_msg</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">void</span><span class="p">:</span>
		<span class="n">error_called</span> <span class="o">=</span> <span class="n">true</span>
	<span class="p">)</span>

	<span class="c1">#act
</span>	<span class="n">var</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dictionary</span> <span class="o">=</span> <span class="n">save</span><span class="p">.</span><span class="nf">load_data</span><span class="p">()</span>

	<span class="c1">#assert
</span>
	<span class="nf">assert_true</span><span class="p">(</span><span class="n">error_called</span><span class="p">)</span> <span class="c1"># this one is
</span>	<span class="nf">assert_not_null</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></div> <p>WystÄ…piÅ‚by bÅ‚Ä…d zwiÄ…zany z tym, Å¼e wartoÅ›ci z funkcji anonimowych sÄ… przekazywane poprzez wartoÅ›Ä‡ a nie poprzez referencje, co oznaczaÅ‚aby, Å¼e wartoÅ›Ä‡ zmiennej <code class="language-plaintext highlighter-rouge">error_called</code> nie zostaÅ‚aby zmieniona a asercja nie powiodÅ‚aby siÄ™.</p> <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#it fails
</span><span class="nf">assert_true</span><span class="p">(</span><span class="n">error_called</span><span class="p">)</span>
</code></pre></div></div> <p>Aby zadziaÅ‚aÅ‚o przekazanie przez referencje naleÅ¼y odnieÅ›Ä‡ siÄ™ do zmiennej z kontekstu obiektu.</p> <p>DziÄ™ki tym prostym trickom udaÅ‚o siÄ™ wywoÅ‚aÄ‡ scenariusz testowy dla walidacji bÅ‚Ä™dÃ³w w deterministyczny i powtarzalny spsÃ³b. RozwiÄ…zanie te ma jednak nastÄ™pujÄ…ce minusy z ktÃ³rymi naleÅ¼y siÄ™ liczyÄ‡:</p> <ul> <li> <p>wymaga stworzenia dublera, ktÃ³ry poÅ‚owicznie odzwierciedla logikÄ™ klasy GameSave</p> </li> <li> <p>dla kaÅ¼dej testowej klasy naleÅ¼y â€œprzykryÄ‡ obsÅ‚ugÄ™ bÅ‚Ä™dÃ³wâ€ dodatkowÄ… metodÄ… <code class="language-plaintext highlighter-rouge">print_error</code> oraz dla kaÅ¼dego testu naleÅ¼y przykryÄ‡ tÄ… metodÄ™ dodatkowym wywoÅ‚aniem metody stub.</p> </li> </ul> <p>Jest to maÅ‚a cena za moÅ¼liwoÅ›Ä‡ trasnparetnego i przyjemnego sprawdzenia obsÅ‚ugi bÅ‚Ä™dÃ³w i walidacji kodu w GDscript. MoÅ¼na to jeszcze na pewno ulepszyÄ‡, ale zostawiam to jako temat na nastÄ™pny artykuÅ‚.</p> <h3 id="moÅ¼liwe-ulepszenia">MoÅ¼liwe ulepszenia</h3> <p>W skrÃ³cie moÅ¼na to ulepszyÄ‡ w nastÄ™pujÄ…cy sposÃ³b:</p> <ul> <li>dodaÄ‡ sprawdzenie zwracanego kodu oraz ich obsÅ‚ugÄ™</li> <li>dodaÄ‡ weryfikacje zwracanego kodu bÅ‚Ä™du w testach</li> <li>dodaÄ‡ wÅ‚asnÄ… warstwÄ™ lub serwis do logowania bÅ‚Ä™dÃ³w</li> </ul>]]></content><author><name></name></author><category term="tutorials"/><category term="game-dev"/><category term="godot"/><category term="tests"/><summary type="html"><![CDATA[Testowanie obsÅ‚ugi bÅ‚Ä™dÃ³w przy pomoc GUT i metody stub w GDscript]]></summary></entry><entry><title type="html">Jak przechowywaÄ‡ duÅ¼e pliki binarne z uÅ¼yciem git lfs na Google Drive lub One Drive?</title><link href="https://ziumper.github.io/pl/blog/2023/how-to-store-big-binary-files-with-git-lfs/" rel="alternate" type="text/html" title="Jak przechowywaÄ‡ duÅ¼e pliki binarne z uÅ¼yciem git lfs na Google Drive lub One Drive?"/><published>2023-10-23T16:40:16+00:00</published><updated>2023-10-23T16:40:16+00:00</updated><id>https://ziumper.github.io/blog/2023/how-to-store-big-binary-files-with-git-lfs</id><content type="html" xml:base="https://ziumper.github.io/blog/2023/how-to-store-big-binary-files-with-git-lfs/"><![CDATA[<h1 id="adapter-transferu">Adapter transferu</h1> <p>SugerujÄ™ poÅ‚Ä…czenie git lfs z niestandardowym adapterem transferu. Zgodnie z dokumentacjÄ… git-lfs:</p> <blockquote> <p>Git LFS obsÅ‚uguje wiele sposobÃ³w przesyÅ‚ania (wgrywania i pobierania) plikÃ³w. W podstawowych aplikacjach klienckich uÅ¼ywa siÄ™ Å¼Ä…dania HTTP za poÅ›rednictwem adresu URL zwrÃ³conego z API LFS dla danego obiektu. Klient obsÅ‚uguje rÃ³wnieÅ¼ rozszerzenia umoÅ¼liwiajÄ…ce wznowienie pobierania (za poÅ›rednictwem nagÅ‚Ã³wkÃ³w Range) i przesyÅ‚ania.</p> </blockquote> <h1 id="przykÅ‚ady-uÅ¼ycia">PrzykÅ‚ady uÅ¼ycia</h1> <p>WykorzystaÅ‚em ten sposÃ³b do przechowywania plikÃ³w multimedialnych w moim projekcie i do rozwoju oprogramowania w projektach zwiÄ…zanych z grami. Jestem pewien, Å¼e i Ty moÅ¼esz to zrobiÄ‡. W wiÄ™kszoÅ›ci przypadkÃ³w lubiÄ™ to stosowaÄ‡ do:</p> <ul> <li>projektÃ³w zwiÄ…zanych z tworzeniem gier w silnikach takich jak Unity i Unreal Engine.</li> <li>przechowywania dbdumps</li> <li>przechowywania duÅ¼ych plikÃ³w multimedialnych (w razie potrzeby)</li> </ul> <p>Zawsze istnieje sposÃ³b, aby to zrobiÄ‡ rÃ³wnieÅ¼ dla innych rodzajÃ³w projektÃ³w.</p> <p>W poniÅ¼szym przykÅ‚adzie bÄ™dÄ™ uÅ¼ywaÅ‚ gitlab, google drive i innych narzÄ™dzi.</p> <h1 id="konfiguracja-gitlab-a">Konfiguracja Gitlab-a</h1> <p>Po pierwsze, musisz wyÅ‚Ä…czyÄ‡ domyÅ›lnÄ… usÅ‚ugÄ™ lfs w gitlabie. Jest to bardzo dobrze udokumentowana funkcja w oficjalnej dokumentacji <a href="https://docs.gitlab.com/ee/topics/git/lfs">Gitlab</a>, ale nie ma zbyt duÅ¼o informacji na temat tego, jak jÄ… wyÅ‚Ä…czyÄ‡.</p> <p>Jest to trochÄ™ skomplikowane i niezbyt przyjazne dla uÅ¼ytkownika, ale oczywiÅ›cie musisz wybraÄ‡ swoje repozytorium i wejÅ›Ä‡ w ustawienia.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/settings_gitlab-480.webp 480w,/assets/img/posts/settings_gitlab-800.webp 800w,/assets/img/posts/settings_gitlab-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/posts/settings_gitlab.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/disable_gitlab_lfs_example-480.webp 480w,/assets/img/posts/disable_gitlab_lfs_example-800.webp 800w,/assets/img/posts/disable_gitlab_lfs_example-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/posts/disable_gitlab_lfs_example.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>Istnieje rÃ³wnieÅ¼ inny sposÃ³b za pomocÄ… wiersza poleceÅ„ gitlab oraz dla narzÄ™dzi CI za pomocÄ… zmiennych Å›rodowiskowych, ale nie bÄ™dÄ™ tego omawiaÅ‚, trzymajmy to proste. JeÅ›li gitlab lfs jest wyÅ‚Ä…czony na zdalnym serwerze, moÅ¼esz zaczÄ…Ä‡ od konfiguracji lokalnej.</p> <h1 id="konfiguracja-lokalnego-repozytorium">Konfiguracja lokalnego repozytorium</h1> <p>BÄ™dziesz potrzebowaÅ‚ nowego repozytorium lub moÅ¼esz uÅ¼yÄ‡ istniejÄ…cego. SugerujÄ™ rozpoczÄ™cie od stanu poczÄ…tkowego, abyÅ› mÃ³gÅ‚ skorzystaÄ‡ z prostego przewodnika konfiguracyjnego poniÅ¼ej.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git init
</code></pre></div></div> <p>Dodaj rÃ³wnieÅ¼ link do serwera zdalnego. MoÅ¼na to zrobiÄ‡ po konfiguracji lub pÃ³Åºniej. Dla lfs z gitlabem moÅ¼esz sugerowaÄ‡ siÄ™ zgodnie z prostym samouczkiem <a href="https://docs.gitlab.com/tutorials/learn_git/">link do git</a></p> <h1 id="konfiguracja-lfs">Konfiguracja lfs</h1> <p>Pobierz narzÄ™dzie adaptera lfs z <a href="https://github.com/sinbad/lfs-folderstore/releases/tag/v1.0.1">dostÄ™pnych wydaÅ„</a>.</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/OIP-480.webp 480w,/assets/img/posts/OIP-800.webp 800w,/assets/img/posts/OIP-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/posts/OIP.jpg" class="img-fluid rounded z-depth-1" width="50%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <p>Pobierz, rozpakuj, zainstaluj je w dobrze znanej lokalizacji. Na przykÅ‚ad utwÃ³rz nowy folder na swoim gÅ‚Ã³wnym dysku roboczym, np. tak: <code class="language-plaintext highlighter-rouge">C:\Tools</code>, wiÄ™c peÅ‚na Å›cieÅ¼ka do narzÄ™dzia bÄ™dzie wyglÄ…daÄ‡ tak: <code class="language-plaintext highlighter-rouge">C:\Tools\lfs-folderstore.exe</code>.</p> <p>Aby skonfigurowaÄ‡ repozytorium z lfs, dodaj plik .gitattributes w swoim repozytorium. PrzykÅ‚ady moÅ¼na znaleÅºÄ‡ pod tym <a href="https://github.com/gitattributes/gitattributes">linkiem</a>.</p> <h2 id="unity-gitattributes">Unity .gitattributes</h2> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## in root

*.cs diff=csharp text
*.cginc text
*.shader text

*.mat merge=unityyamlmerge eol=lf
*.anim merge=unityyamlmerge eol=lf
*.unity merge=unityyamlmerge eol=lf
*.prefab merge=unityyamlmerge eol=lf
*.physicsMaterial2D merge=unityyamlmerge eol=lf
*.physicMaterial merge=unityyamlmerge eol=lf
*.asset merge=unityyamlmerge eol=lf -text
*.meta merge=unityyamlmerge eol=lf
*.controller merge=unityyamlmerge eol=lf

## git-lfs ##

#Image
*.jpg filter=lfs diff=lfs merge=lfs -text
*.jpeg filter=lfs diff=lfs merge=lfs -text
*.png filter=lfs diff=lfs merge=lfs -text
*.gif filter=lfs diff=lfs merge=lfs -text
*.psd filter=lfs diff=lfs merge=lfs -text
*.ai filter=lfs diff=lfs merge=lfs -text
*.tif filter=lfs diff=lfs merge=lfs -text

#Audio
*.mp3 filter=lfs diff=lfs merge=lfs -text
*.wav filter=lfs diff=lfs merge=lfs -text
*.ogg filter=lfs diff=lfs merge=lfs -text
#Wwise
*.bnk filter=lfs diff=lfs merge=lfs -text

#Video
*.mp4 filter=lfs diff=lfs merge=lfs -text
*.mov filter=lfs diff=lfs merge=lfs -text

#3D Object
*.FBX filter=lfs diff=lfs merge=lfs -text
*.fbx filter=lfs diff=lfs merge=lfs -text
*.blend filter=lfs diff=lfs merge=lfs -text
*.obj filter=lfs diff=lfs merge=lfs -text

#ETC
*.a filter=lfs diff=lfs merge=lfs -text
*.exr filter=lfs diff=lfs merge=lfs -text
*.tga filter=lfs diff=lfs merge=lfs -text
*.zip filter=lfs diff=lfs merge=lfs -text
*.dll filter=lfs diff=lfs merge=lfs -text
*.unitypackage filter=lfs diff=lfs merge=lfs -text
*.aif filter=lfs diff=lfs merge=lfs -text
*.ttf filter=lfs diff=lfs merge=lfs -text
*.rns filter=lfs diff=lfs merge=lfs -text
*.reason filter=lfs diff=lfs merge=lfs -text
*.lxo filter=lfs diff=lfs merge=lfs -text

</code></pre></div></div> <h2 id="unreal-engine-gitattributes">Unreal Engine .gitattributes</h2> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Unreal Engine
## Auto detect text files and perform LF normalization ##

* text=auto

# UE file types
*.uasset filter=lfs diff=lfs merge=lfs -text
*.umap filter=lfs diff=lfs merge=lfs -text
*.udk filter=lfs diff=lfs merge=lfs -text
*.upk filter=lfs diff=lfs merge=lfs -text

--------------------------------------------------

# 2D formats
# Read more in: https://docs.unrealengine.com/4.26/en-US/RenderingAndGraphics/Textures/Importing/

# Recommended use:
*.[tT][gG][aA] filter=lfs diff=lfs merge=lfs -text
*.[pP][nN][gG] filter=lfs diff=lfs merge=lfs -text
*.[bB][mM][pP] filter=lfs diff=lfs merge=lfs -text

# Can also be used:
*.[fF][lL[oO][aA][tT] filter=lfs diff=lfs merge=lfs -text
*.[jJ][pP][eE][gG] filter=lfs diff=lfs merge=lfs -text
*.[jJ][pP][gG] filter=lfs diff=lfs merge=lfs -text
*.[pP][cC][xX] filter=lfs diff=lfs merge=lfs -text
*.[pP][sS][dD] filter=lfs diff=lfs merge=lfs -text
*.[xX][cC][fF] filter=lfs diff=lfs merge=lfs -text
*.[tT][iI][fF] filter=lfs diff=lfs merge=lfs -text
*.[tT][iI][fF][fF] filter=lfs diff=lfs merge=lfs -text

# Other supported formats:
*.[hH][dD][rR] filter=lfs diff=lfs merge=lfs -text
*.[dD][dD][sS] filter=lfs diff=lfs merge=lfs -text
*.[eE][xX][rR] filter=lfs diff=lfs merge=lfs -text

--------------------------------------------------

# 3D formats

# Always recommended to use:
# The UE4 FBX import pipeline uses FBX 2018
*.[fF][bB][xX] filter=lfs diff=lfs merge=lfs -text

# Can also be used:
*.[oO][bB][jJ] filter=lfs diff=lfs merge=lfs -text

# Other supported formats:
*.[aA][bB][cC] filter=lfs diff=lfs merge=lfs -text
*.[sS][rR][tT] filter=lfs diff=lfs merge=lfs -text

--------------------------------------------------

# Audio formats
# Read more in: https://docs.unrealengine.com/4.27/en-US/WorkingWithAudio/Overview/#:~:text=Unreal%20Engine%204%20(UE4)%20supports,16%2Dbit%20format%20PCM%20files.

# Always recommended to use:
*.[wW][aA][vV] filter=lfs diff=lfs merge=lfs -text

# Can also be used:
*.[aA][iI][fF][fF] filter=lfs diff=lfs merge=lfs -text
*.[oO][gG][gG] filter=lfs diff=lfs merge=lfs -text
*.[fF][lL][aA][cC] filter=lfs diff=lfs merge=lfs -text

# Not recommended to use, but supported:
*.[mM][pP]3 filter=lfs diff=lfs merge=lfs -text
*.[wW][mM][aA] filter=lfs diff=lfs merge=lfs -text
*.[aA][cC]3 filter=lfs diff=lfs merge=lfs -text
*.[aA][mM][rR] filter=lfs diff=lfs merge=lfs -text
*.[aA][iI][fF] filter=lfs diff=lfs merge=lfs -text
*.[aA][uU] filter=lfs diff=lfs merge=lfs -text
*.[cC][dD][dD][aA] filter=lfs diff=lfs merge=lfs -text
*.[cC][aA][fF] filter=lfs diff=lfs merge=lfs -text
*.[bB][wW][fF] filter=lfs diff=lfs merge=lfs -text
*.[aA][dD][tT][sS] filter=lfs diff=lfs merge=lfs -text

--------------------------------------------------

# Video formats
# Read more in: https://docs.unrealengine.com/5.0/en-US/media-framework-technical-reference-for-unreal-engine/

# Always recommended to use, supports all platforms:
# For the best compatibility and performance, it is recommended to use H.264 encoded MP4 (.mp4) container files.
*.[mM][pP]4 filter=lfs diff=lfs merge=lfs -text

# Can also be used, only some platforms are supported:
*.3[gG]2 filter=lfs diff=lfs merge=lfs -text
*.3[gG][pP] filter=lfs diff=lfs merge=lfs -text
*.3[gG][pP]2 filter=lfs diff=lfs merge=lfs -text
*.3[gG][pP][pP] filter=lfs diff=lfs merge=lfs -text
*.[mM]4[aA] filter=lfs diff=lfs merge=lfs -text
*.[mM]4[vV] filter=lfs diff=lfs merge=lfs -text
*.[mM][o][vV] filter=lfs diff=lfs merge=lfs -text
*.[aA][sS][fF] filter=lfs diff=lfs merge=lfs -text
*.[aA][vV][iI] filter=lfs diff=lfs merge=lfs -text
*.[wW][mM][vV] filter=lfs diff=lfs merge=lfs -text

--------------------------------------------------

# Fonts
# Read more in: https://docs.unrealengine.com/5.0/en-US/importing-fonts-in-unreal-engine/

*.[tT][tT][fF] filter=lfs diff=lfs merge=lfs -text
*.[oO][tT][fF] filter=lfs diff=lfs merge=lfs -text

--------------------------------------------------

# Documents
*.[cC][sS][vV] filter=lfs diff=lfs merge=lfs -text

</code></pre></div></div> <h1 id="konfiguracja-google-drive">Konfiguracja Google Drive</h1> <p>JeÅ›li repozytorium jest gotowe, bÄ™dziesz potrzebowaÄ‡ jakiegoÅ› rodzaju przestrzeni dyskowej, aby to dziaÅ‚aÅ‚o. Aby w peÅ‚ni zintegrowaÄ‡ to z Google Drive, uÅ¼yj klienta Google Drive <a href="https://www.google.com/drive/download/">Pobierz</a>. Zainstaluj go, zaloguj siÄ™, aby moÅ¼na byÅ‚o utworzyÄ‡ folder do przechowywania wszystkich duÅ¼ych danych binarnych.</p> <p>Po zalogowaniu powinieneÅ› zobaczyÄ‡ swÃ³j zamontowany folder w Finderze, jeÅ›li uÅ¼ywasz Maca, lub w Exploratorze Windows, jako oddzielony dysk. OtwÃ³rz go i utwÃ³rz nowy folder o nazwie <code class="language-plaintext highlighter-rouge">binary-lfs</code>. Ta nazwa bÄ™dzie uÅ¼ywana do przechowywania wszystkich danych binarnych dla Twojego projektu w konfiguracji lfs.</p> <h1 id="integracja-konfiguracji-git">Integracja konfiguracji Git</h1> <p>JeÅ›li wszystko zostaÅ‚o wykonane prawidÅ‚owo, teraz nadszedÅ‚ czas, aby poÅ‚Ä…czyÄ‡ git-lfs z naszym narzÄ™dziem i Google Drive.</p> <p>UÅ¼yÅ‚em mojego ulubionego otwartoÅºrÃ³dÅ‚owego oprogramowania <a href="https://git-extensions-documentation.readthedocs.io/">GitExtension</a> jako odniesienia do integracji, ale moÅ¼esz uÅ¼yÄ‡ terminala za pomocÄ… podejÅ›cia z konfiguracjÄ… git config lub dowolnego edytora tekstu. W przypadku korzystania z edytora tekstu otwÃ³rz plik konfiguracyjny w ukrytym folderze .git w gÅ‚Ã³wnym folderze Twojego projektu repozytorium.</p> <p>Aby otworzyÄ‡ konfiguracjÄ™ Twojego repozytorium github, wybierz nastÄ™pujÄ…cÄ… opcjÄ™:</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/integration_gitextension-480.webp 480w,/assets/img/posts/integration_gitextension-800.webp 800w,/assets/img/posts/integration_gitextension-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/posts/integration_gitextension.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <p>OtwÃ³rz go i dodaj nastÄ™pujÄ…ce linie.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[lfs "customtransfer.lfs-folder"]
    path = C:\\Tools\\lfs-folderstore.exe
    args = 'I:\\My drive\\binary-lfs'
[lfs]
    standalonetransferagent = lfs-folder
    repositoryformatversion = 0
</code></pre></div></div> <p>NastÄ™pnie, pamiÄ™taj, aby posortowaÄ‡ pliki LFS i skopiowaÄ‡ zawartoÅ›Ä‡ skonfigurowanego wspÃ³lnego folderu, uÅ¼ywajÄ…c nastÄ™pujÄ…cej komendy</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git reset <span class="nt">--hard</span> master
</code></pre></div></div> <p>lub jeÅ›li korzystasz z nowego repozytorium, po prostu je wyÅ›lij</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git push -u origin main
</code></pre></div></div> <h1 id="rozwiÄ…zywanie-problemÃ³w">RozwiÄ…zywanie problemÃ³w</h1> <p>Czasami mogÄ… pojawiÄ‡ siÄ™ problemy z TwojÄ… sieciÄ… lub z git lfs. W przypadku bÅ‚Ä™dÃ³w smudge lub innych problemÃ³w moÅ¼na wyprÃ³bowaÄ‡ nastÄ™pujÄ…ce triki:</p> <ul> <li>sprÃ³buj uÅ¼yÄ‡ lepszego poÅ‚Ä…czenia internetowego, sÅ‚aby pasmo sieciowe nie pomaga</li> <li>zrestartuj komputer</li> <li>uÅ¼yj <code class="language-plaintext highlighter-rouge">git lfs fetch --all</code> pobiera pliki git lfs dla WSZYSTKICH zdalnych gaÅ‚Ä™zi</li> <li>przenieÅ› katalog cache Google Drive lub One Drive do nowego folderu i sprÃ³buj ponownie pobraÄ‡ dane</li> </ul> <h1 id="bibliografia-i-ÅºrÃ³dÅ‚a">Bibliografia i ÅºrÃ³dÅ‚a</h1> <ul> <li><a href="https://github.com/sinbad/lfs-folderstore">Lfs folderstore repo</a></li> <li><a href="https://www.google.com/drive/download/">Google Drive</a></li> <li><a href="https://docs.gitlab.com/">Gitlab Docs</a></li> </ul>]]></content><author><name></name></author><category term="tutorials"/><category term="git"/><category term="unity"/><category term="unreal-engine"/><summary type="html"><![CDATA[Sprawdzony sposÃ³b na darmowy hosting plikÃ³w przy pomocy adaptera LFS.]]></summary></entry><entry><title type="html">Jak rozwiÄ…zywaÄ‡ konfilkty przy pomocy GitExtensions?</title><link href="https://ziumper.github.io/pl/blog/2022/how-to-solve-rebase-merge-conflicts-with-GitExtensions/" rel="alternate" type="text/html" title="Jak rozwiÄ…zywaÄ‡ konfilkty przy pomocy GitExtensions?"/><published>2022-08-06T16:40:16+00:00</published><updated>2022-08-06T16:40:16+00:00</updated><id>https://ziumper.github.io/blog/2022/how-to-solve-rebase-merge-conflicts-with-GitExtensions</id><content type="html" xml:base="https://ziumper.github.io/blog/2022/how-to-solve-rebase-merge-conflicts-with-GitExtensions/"><![CDATA[<p>Czy kiedykolwiek zastanawiaÅ‚eÅ› siÄ™, jak Å‚atwo poÅ‚Ä…czyÄ‡ swoje zmiany bez niszczenia caÅ‚ego projektu? Oto szybki i prosty przewodnik. Zaczynamy! Po pierwsze, powinieneÅ› zainstalowaÄ‡ i skonfigurowaÄ‡ <a href="https://git-extensions-documentation.readthedocs.io/">GitExtensions</a>. NastÄ™pnie otwÃ³rz swoje repozytorium. W moim przypadku zawiera ono dwie gaÅ‚Ä™zie: master i develop. SprawdÅº obraz poniÅ¼ej, aby to zobaczyÄ‡.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/gitExtensions_1-480.webp 480w,/assets/img/posts/gitExtensions_1-800.webp 800w,/assets/img/posts/gitExtensions_1-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/posts/gitExtensions_1.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/gitExtensions_2-480.webp 480w,/assets/img/posts/gitExtensions_2-800.webp 800w,/assets/img/posts/gitExtensions_2-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/posts/gitExtensions_2.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>Zawiera plik hello.html z tym samym edytowanym wierszem, wiÄ™c nie wie, ktÃ³ry wiersz powinien byÄ‡ uÅ¼yty, gdy <a href="https://www.atlassian.com/git/tutorials/using-branches/merge-conflicts">conflict</a> wystÄ…pi.</p> <h2 id="jak-zmieniÄ‡-baze">Jak zmieniÄ‡ baze?</h2> <p>Aby <a href="https://www.atlassian.com/git/tutorials/rewriting-history/git-rebase">przebazowaÄ‡</a> z gaÅ‚Ä™zi develop na gaÅ‚Ä…Åº master, aby zatwierdzenie na gaÅ‚Ä™zi develop byÅ‚o â€œnadâ€ zatwierdzeniami z gaÅ‚Ä™zi master i tak aby zawieraÅ‚ wszystkie zatwierdzenia z gaÅ‚Ä™zi master takÅ¼e. Jak to zrobiÄ‡? PrzeÅ‚Ä…cz siÄ™ na gaÅ‚Ä…Åº develop. Kliknij prawym przyciskiem myszy na niej. Wybierz opcjÄ™ przeÅ‚Ä…czenia gaÅ‚Ä™zi, a nastÄ™pnie wybierz gaÅ‚Ä…Åº develop.</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/gitExtensions_3-480.webp 480w,/assets/img/posts/gitExtensions_3-800.webp 800w,/assets/img/posts/gitExtensions_3-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/posts/gitExtensions_3.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <p>Kiedy jesteÅ› na gaÅ‚Ä™zi develop, wybierz, dla ktÃ³rego zatwierdzenia chcesz zmieniÄ‡ bazÄ™. W moim przypadku jest to zatwierdzenie z gaÅ‚Ä™zi master o wiadomoÅ›ci â€œHope it will workâ€.</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/gitExtensions_4-480.webp 480w,/assets/img/posts/gitExtensions_4-800.webp 800w,/assets/img/posts/gitExtensions_4-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/posts/gitExtensions_4.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <p>Po klikniÄ™ciu â€œyesâ€, aby zmieniÄ‡ bazÄ™, powinieneÅ› zobaczyÄ‡ komunikat o bÅ‚Ä™dzie, ale nie martw siÄ™, nie ma w tym nic zÅ‚ego z git. To tylko informacja dla Ciebie, Å¼e musisz rozwiÄ…zaÄ‡ kilka konfliktÃ³w.</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/gitExtensions_5-480.webp 480w,/assets/img/posts/gitExtensions_5-800.webp 800w,/assets/img/posts/gitExtensions_5-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/posts/gitExtensions_5.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <p>NastÄ™pnie kliknij OK i kontynuuj. NastÄ™pnie powinieneÅ› zobaczyÄ‡ podobne okno poniÅ¼ej:</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/gitExtensions_6-480.webp 480w,/assets/img/posts/gitExtensions_6-800.webp 800w,/assets/img/posts/gitExtensions_6-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/posts/gitExtensions_6.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <p>Wybierz rozwiÄ…zanie konfliktÃ³w, a nastÄ™pnie powinno pojawiÄ‡ siÄ™ kolejne okno.</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/gitExtensions_7-480.webp 480w,/assets/img/posts/gitExtensions_7-800.webp 800w,/assets/img/posts/gitExtensions_7-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/posts/gitExtensions_7.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <p>To okno jest oknem rozwiÄ…zywania konfliktÃ³w scalania. MoÅ¼esz rozwiÄ…zaÄ‡ konflikty scalania na dwa sposoby. Szybki i Å‚atwy drugi sposÃ³b, dla ktÃ³rego uÅ¼ywasz narzÄ™dzia do porÃ³wnywania rÃ³Å¼nic, jak <a href="https://github.com/KDE/kdiff3">kdiff3</a>.</p> <h2 id="szybki-i-Å‚atwy-sposÃ³b-rozwiÄ…zania-konfliktÃ³w-scalania">Szybki i Å‚atwy sposÃ³b rozwiÄ…zania konfliktÃ³w scalania.</h2> <p>MoÅ¼esz zastosowaÄ‡ zmiany dla pliku hello.html, odrzucajÄ…c swoje zmiany i korzystajÄ…c z zmian z gaÅ‚Ä™zi master. Kliknij prawym przyciskiem myszy na pliku hello.html i wybierz (theirs), jak na obrazie poniÅ¼ej:</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/gitExtensions_8-480.webp 480w,/assets/img/posts/gitExtensions_8-800.webp 800w,/assets/img/posts/gitExtensions_8-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/posts/gitExtensions_8.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <p>JeÅ›li chcesz nadpisaÄ‡ zmiany, zawsze moÅ¼esz uÅ¼yÄ‡ opcji (ours). NastÄ™pnie kliknij kontynuuj przebazowanie w gÅ‚Ã³wnym oknie przebazowania.</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/gitExtensions_9-480.webp 480w,/assets/img/posts/gitExtensions_9-800.webp 800w,/assets/img/posts/gitExtensions_9-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/posts/gitExtensions_9.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <p>W przypadku wiÄ™kszej liczby plikÃ³w lub konfliktÃ³w, bÄ™dziesz musiaÅ‚ je rozwiÄ…zaÄ‡ pÃ³Åºniej. PamiÄ™taj, Å¼e praca z wiÄ™kszymi plikami lub zmianami moÅ¼e zajÄ…Ä‡ trochÄ™ czasu.</p> <h2 id="praca-z-narzÄ™dziem-do-porÃ³wnywania-rÃ³Å¼nic">Praca z narzÄ™dziem do porÃ³wnywania rÃ³Å¼nic</h2> <p>Tutaj zmodyfikowaÅ‚em trochÄ™ historiÄ™ repozytorium, wiÄ™c moÅ¼emy z tym pracowaÄ‡</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/gitExtensions_10-480.webp 480w,/assets/img/posts/gitExtensions_10-800.webp 800w,/assets/img/posts/gitExtensions_10-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/posts/gitExtensions_10.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <p>Przebazuj ponownie i rozwijaj na gaÅ‚Ä…Åº master.</p> <ol> <li> <p>PrzeÅ‚Ä…cz siÄ™ na gaÅ‚Ä…Åº develop</p> </li> <li> <p>Wybierz pierwszy commit z gaÅ‚Ä™zi master z wiadomoÅ›ciÄ… â€œSome other changesâ€ i kliknij prawym przyciskiem myszy na nim</p> </li> <li> <p>Przebazuj bieÅ¼Ä…cÄ… gaÅ‚Ä…Åº na -&gt; wybrany commit.</p> </li> </ol> <p>NastÄ™pnie zaczyna siÄ™ magia. Pomijam kroki do okna konfliktÃ³w scalania, ktÃ³re sÄ… takie same jak powyÅ¼ej. Wybierz otwÃ³rz je w kdiff3 lub innym narzÄ™dziu do scalania/porÃ³wnywania.</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/gitExtensions_11-480.webp 480w,/assets/img/posts/gitExtensions_11-800.webp 800w,/assets/img/posts/gitExtensions_11-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/posts/gitExtensions_11.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <p>PowinieneÅ› zobaczyÄ‡ okno podobne do poniÅ¼szego:</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/gitExtensions_12-480.webp 480w,/assets/img/posts/gitExtensions_12-800.webp 800w,/assets/img/posts/gitExtensions_12-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/posts/gitExtensions_12.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <p>NastÄ™pnie wystÄ™pujÄ… trzy katalogi scalania:</p> <ul> <li> <p>(â€œAâ€ jest traktowane jako starsza baza obu).</p> </li> <li> <p>B - jest (ich) wersjÄ… gaÅ‚Ä™zi master</p> </li> <li> <p>C - jest (nasze) w tym przypadku wersjÄ… gaÅ‚Ä™zi develop</p> </li> </ul> <p>PoniÅ¼ej znajduje siÄ™ okno wyjÅ›cia, ktÃ³re zawiera wynik scalania.</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/gitExtensions_13-480.webp 480w,/assets/img/posts/gitExtensions_13-800.webp 800w,/assets/img/posts/gitExtensions_13-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/posts/gitExtensions_13.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <p>MoÅ¼esz wybraÄ‡ wersjÄ™ pliku, ktÃ³rÄ… chcesz zostawiÄ‡ i poÅ‚Ä…czyÄ‡ je. MoÅ¼esz zobaczyÄ‡, Å¼e wybraÅ‚em jednÄ… liniÄ™ z C, jednÄ… liniÄ™ z A i jednÄ… liniÄ™ z B. NastÄ™pnie zapisaÅ‚em plik i kontynuowaÅ‚em przebazowanie po rozwiÄ…zaniu konfliktÃ³w. To proste, ale czasami sytuacja moÅ¼e siÄ™ skomplikowaÄ‡, wiÄ™c uwaÅ¼aj.</p> <p>PoniÅ¼ej widoczny jest wynik zmiany bazy:</p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/gitExtensions_14-480.webp 480w,/assets/img/posts/gitExtensions_14-800.webp 800w,/assets/img/posts/gitExtensions_14-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/posts/gitExtensions_14.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <p>Stworzy to rozszerzenia plikÃ³w .orig, wiÄ™c zawsze moÅ¼esz zobaczyÄ‡ historiÄ™ swoich zmian.</p> <p>Lepiej nie commitowaÄ‡ tych plikÃ³w do repozytorium.</p> <p>To wszystko! Mam nadziejÄ™, Å¼e artykuÅ‚ pomoÅ¼e Ci w rozwiÄ…zywaniu konfliktÃ³w!</p>]]></content><author><name></name></author><category term="tutorials"/><category term="git"/><summary type="html"><![CDATA[RozwiÄ…zywanie konfliktÃ³w. W jaki sposÃ³b poradziÄ‡ sobie z rebase a jak z merge requestami.]]></summary></entry><entry><title type="html">Jak zaczÄ…Ä‡ z GIT-em?</title><link href="https://ziumper.github.io/pl/blog/2022/how-to-start-with-git/" rel="alternate" type="text/html" title="Jak zaczÄ…Ä‡ z GIT-em?"/><published>2022-07-17T16:40:16+00:00</published><updated>2022-07-17T16:40:16+00:00</updated><id>https://ziumper.github.io/blog/2022/how-to-start-with-git</id><content type="html" xml:base="https://ziumper.github.io/blog/2022/how-to-start-with-git/"><![CDATA[<p>ZastanawiaÅ‚em siÄ™, co oznacza GIT. Oto co znalazÅ‚em:</p> <blockquote> <p>GIT to sÅ‚owo bÄ™dÄ…ce skrÃ³tem od angielskiego sÅ‚owa â€œgetâ€, ktÃ³re zostaÅ‚o skrÃ³cone z â€œbegettingâ€. Jest rÃ³wnieÅ¼ niejawne odniesienie do nieÅ›lubnych potomkÃ³w, a termin jest mniej wiÄ™cej synonimem gÅ‚upca, durnia, kretyna lub idioty. W spoÅ‚ecznoÅ›ci open source znaczenie wyboru nazwy rÃ³Å¼ni siÄ™.</p> </blockquote> <p>Oznacza to, Å¼e GIT jest dla idiotÃ³w, ktÃ³rzy nie wiedzÄ…, co robiÄ…. DoskonaÅ‚e narzÄ™dzie dla programisty. Zacznijmy od poczÄ…tku.</p> <p>Linus Torvalds zdecydowaÅ‚ siÄ™ na jego rozwÃ³j dla jÄ…dra Linuxa. Od 2005 roku pomaga programistom Å›ledziÄ‡ zmiany w kodzie. DostÄ™pny we wszystkich systemach operacyjnych i uÅ¼ywany przez uÅ¼ytkownikÃ³w na caÅ‚ym Å›wiecie. Åatwo z nim zaczÄ…Ä‡, ale trudniej byÄ‡ w nim eksperte. Jest to system kontroli wersji. MoÅ¼esz go pobraÄ‡ ze <a href="https://git-scm.com/downloads">tej strony</a> i wyprÃ³bowaÄ‡ samodzielnie.</p> <h1 id="podstawy">Podstawy</h1> <p>Pobierz i zainstaluj <a href="https://git-scm.com/downloads">gita</a> na swoim systemie operacyjnym. Aby kontynuowaÄ‡, musisz otworzyÄ‡ terminal. Po instalacji powinieneÅ› byÄ‡ w stanie wykonaÄ‡ kilka poleceÅ„ gita. UtwÃ³rz nowy folder. NastÄ™pnie otwÃ³rz terminal w nowym folderze. UtwÃ³rzmy repozytorium. Aby to osiÄ…gnÄ…Ä‡, uÅ¼yj poniÅ¼szego polecenia.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git init
</code></pre></div></div> <h1 id="narzÄ™dzia">NarzÄ™dzia</h1> <p>Istnieje kilka narzÄ™dzi GUI (ang. Graphic User Interface), ktÃ³re mogÄ… pomÃ³c Ci w rozpoczÄ™ciu pracy z Gitem. JeÅ›li nie jesteÅ› fanem terminala, polecam <a href="https://gitextensions.github.io/">GitExtensions</a></p> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/gitextension-480.webp 480w,/assets/img/posts/gitextension-800.webp 800w,/assets/img/posts/gitextension-1400.webp 1400w," sizes="95vw" type="image/webp"/> <img src="/assets/img/posts/gitextension.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" alt="git extensions editor window" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <p>Alternatywnie moÅ¼esz uÅ¼yÄ‡ <a href="https://www.sourcetreeapp.com/">SourceTree</a> jest on darmowÄ… alternatywÄ… dla systemu Mac. MyÅ›lÄ™, Å¼e jeÅ›li uÅ¼ywasz Linuxa, to rÃ³wnie dobrze moÅ¼esz rÃ³wnieÅ¼ korzystaÄ‡ z terminala.</p> <p><img src="https://wac-cdn.atlassian.com/dam/jcr:580c367b-c240-453d-aa18-c7ced44324f9/hero-mac-screenshot.png?cdnVersion=651" alt="SourceTree!"/></p> <h1 id="commit">Commit</h1> <p>Dobrze, jak dotÄ…d! Teraz zrÃ³bmy kilka commitÃ³w. StwÃ³rz plik HTML o nastÄ™pujÄ…cej zawartoÅ›ci.</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>Hello there<span class="nt">&lt;/h1&gt;</span>
</code></pre></div></div> <p>Teraz jesteÅ› gotowy, do daleszej pracy z obszarem staging. Co to jest obszar staging - wyjaÅ›nijmy to jako pudeÅ‚ko, do ktÃ³rego wkÅ‚adasz rzeczy, a nastÄ™pnie uÅ¼ywasz go jako migawki, aby zatwierdziÄ‡ zmiany. Aby to zrobiÄ‡, powinieneÅ› okreÅ›liÄ‡ Å›cieÅ¼kÄ™ do pliku w formacie pliku lub Å›cieÅ¼kÄ™ z jakimÅ› wzorcem, np.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.txt .xml, etc.
</code></pre></div></div> <p>Polecenie dodawania pliku hello.html w terminalu</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add hello.html
</code></pre></div></div> <p>MoÅ¼esz takÅ¼e dodaÄ‡ wszystkie pliki</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add <span class="k">*</span>
</code></pre></div></div> <p>NastÄ™pnie, wpisujÄ…c:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git status
</code></pre></div></div> <p>PowinieneÅ› zobaczyÄ‡ wszystkie pliki, ktÃ³re zostaÅ‚y przez ciebie dodane do obszaru staging.</p> <p>NastÄ™pnie moÅ¼esz zatwierdziÄ‡ hello.html w swoim lokalnym repozytorium.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git commit <span class="nt">-m</span> <span class="s2">"Add hello there file"</span>
</code></pre></div></div> <p>commit - to polecenie, ktÃ³re zapisuje migawkÄ™ â€œpudeÅ‚kaâ€, ktÃ³re wczeÅ›niej dodaliÅ›my.</p> <h1 id="commits-message-standards">Commits message standards</h1> <p>ChcÄ™ wyjaÅ›niÄ‡ kilka standardÃ³w dotyczÄ…cych wiadomoÅ›ci commitÃ³w i jak czÄ™sto powinieneÅ› to robiÄ‡. SÅ‚yszaÅ‚em, Å¼e im czÄ™Å›ciej to robisz, tym lepiej. Nie ma ograniczenia, pÃ³Åºniej zawsze moÅ¼esz zmniejszyÄ‡ liczbÄ™ commitÃ³w, uÅ¼ywajÄ…c funkcji squash. Zacznijmy od formy wiadomoÅ›ci commita. Jak to powinno siÄ™ robiÄ‡:</p> <ul> <li> <p>UÅ¼yj zdaniowych trybÃ³w w linii tematu, np. â€œNaprawia uszkodzony link do Javadocâ€</p> </li> <li> <p>Rozpocznij zdanie linii tematu wielkÄ… literÄ…, np. â€œDodaje, Usuwa, Naprawia, Wprowadza, Unikaj itp.â€</p> </li> <li> <p>Nie koÅ„cz linii tematu kropkÄ…</p> </li> <li> <p>Zachowaj linie tematu do 50 znakÃ³w lub mniej, jeÅ›li to moÅ¼liwe</p> </li> <li> <p>Zawijaj linie w treÅ›ci na 72 znaki lub mniej</p> </li> <li> <p>WzmieÅ„ zwiÄ…zane z nim numery Jira na koÅ„cu komentarza commita, poprzedzone â€Issue:â€ jak powyÅ¼ej</p> </li> <li> <p>W treÅ›ci wiadomoÅ›ci commita wyjaÅ›nij, jak dziaÅ‚aÅ‚y rzeczy przed tym commitem, co siÄ™ zmieniÅ‚o i jak teraz dziaÅ‚ajÄ… rzeczy</p> </li> </ul> <p>Lubie takÅ¼e dodaÄ‡ jakiÅ› rodzaj tagu przed wiadomoÅ›ciÄ… commita, oto kilka przykÅ‚adÃ³w:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â€“ Feature

â€“ Bugfix

â€“ Cleanup

â€“ Hotfix
</code></pre></div></div> <p>Kiedy pracujesz nad zadaniem, dobrze jest dodaÄ‡ pewnÄ… liczbÄ™ zadaÅ„, takich jak #123, ktÃ³re odnoszÄ… siÄ™ do niektÃ³rych. PodsumowujÄ…c, powinno to wyglÄ…daÄ‡ tak:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>FEATURE] <span class="c">#123 My super not quite long commit message.</span>


Here goes body messages where we describe what is going on.
Keep it short as much as you can, but include all necessary details
inside.

Footer where summary and all other references should be applied <span class="k">for
</span>example:
Those commits resolve issue <span class="c">#123 and #124</span>
</code></pre></div></div> <p>Git branches â€“ tree of changes Commits can be added to branches. The branch is a set of commits that are separated from the main branch just like in a tree with leafs. To create a branch:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git branch &lt;branch_name&gt;
</code></pre></div></div> <p>Aby zmieniÄ‡ gaÅ‚Ä…Åº</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout &lt;branch_name&gt;
</code></pre></div></div> <p>Po zainicjowaniu repozytorium gita zwykle masz jednÄ… istniejÄ…cÄ… gÅ‚Ã³wnÄ… gaÅ‚Ä…Åº, z ktÃ³rej wszystkie utworzone pÃ³Åºniej gaÅ‚Ä™zie mogÄ… byÄ‡ pochodne. UÅ¼ywaj ich, aby grupowaÄ‡ pewne zmiany w funkcji, nad ktÃ³rÄ… pracujesz.</p> <h1 id="workflow">Workflow</h1> <p>Polecam zapoznanie siÄ™ z kilkoma pojÄ™ciami gita, takimi jak gaÅ‚Ä…Åº, rebase, merge i squash. Po tym moÅ¼esz zaczÄ…Ä‡ myÅ›leÄ‡ o tym, jak pracowaÄ‡ i zarzÄ…dzaÄ‡ swojÄ… pracÄ… jako programista. Jestem wielkim zwolennikiem normalizacji i standardÃ³w przepÅ‚ywÃ³w pracy. ZnalazÅ‚em kilka metodologii, ktÃ³re sÄ… popularne obecnie podczas pracy z gitem.</p> <ul> <li>Gitflow</li> <li>Trunk</li> </ul> <p>Wybierz pierwszy, jeÅ›li nie masz w swoim zestawie narzÄ™dzi CI/CD. Drugi jest Å›wietny przy pracy z zintegrowanymi narzÄ™dziami do przeglÄ…du kodu.</p>]]></content><author><name></name></author><category term="tutorials"/><category term="git"/><summary type="html"><![CDATA[ÅšmiaÅ‚y artykuÅ‚ i poczÄ…tek serio o gicie.]]></summary></entry></feed>